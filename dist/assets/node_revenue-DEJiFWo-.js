import{g as Q,u as Z}from"./node-WjMSIdQA.js";import{m as ee}from"./machines-C98zF417.js";import{i as ae,a as U}from"./date-BwSFrXps.js";import{u as le}from"./useToast-x_1EYsvM.js";import{_ as oe,r as n,U as S,B as te,g as se,w as s,X as re,f as u,a as ne,b as V,h as t,u as C,i,t as v,Y as ue}from"./index-BATlB_Q3.js";import"./request-CQf3S4Yc.js";const ce={class:"mb-4"},de={class:"filters-row"},ie={class:"table-responsive"},pe={class:"flex justify-end mt-4"},me={class:"ml-4 self-center text-gray-600"},ve={__name:"node_revenue",setup(_e){const{init:w}=le(),I=re(),p=n(),d=n(""),O=n([]),x=n([]),_=n(x[0]),T=a=>a.map(e=>({value:e,text:e})),f=async()=>{try{const a=await ee(),e={value:"",text:"所有"};O.value=[e,...T(a.currencies||[])],x.value=[e,...T(a.groups||[])]}catch(a){console.error("接口调用失败:",a)}},h=n(1),g=n(0),k=n([]),P=n(!1),m=S({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),M=a=>{if(!a)return"";const e=new Date(a),c=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),D=String(e.getDate()).padStart(2,"0");return`${c}-${r}-${D}`},y=async()=>{var a,e;P.value=!0;try{const c={page:m.page,pagesize:m.pagesize,currency:(a=d.value)==null?void 0:a.value,group:(e=_.value)==null?void 0:e.value};p.value&&(c.date=M(p.value));const r=await Q(c);r!=null&&r.pool_profits?(k.value=r.pool_profits,g.value=r.total):(k.value=[],g.value=0)}catch(c){console.error("获取数据失败:",c),w({message:c.message||"获取数据失败",color:"danger"}),k.value=[],g.value=0}finally{P.value=!1}},N=()=>{I.push({name:"tao_revenue"})};te([p,d,_],()=>{var a;if(m.page=1,h.value=1,console.log("searchCurrency.value is",d.value),((a=d.value)==null?void 0:a.value)==="tao"){w({message:"",color:"info",duration:5e3,render:()=>ue("a",{href:"javascript:void(0);",style:"color: #fff; text-decoration: underline;",onClick:()=>N()},"请去TAO收益页面查看")});return}y(),f()});const F={0:"未知",1:"zkwork",2:"oula",3:"daxiang",4:"f2pool"},B=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"reward",label:"奖励"},{key:"real_reward",label:"实际奖励"},{key:"power",label:"算力"},{key:"real_power",label:"实际算力"},{key:"currency",label:"币种"},{key:"pool_type",label:"矿池类型"},{key:"group",label:"分组"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],b=n(!1),o=S({id:null,real_power:"",real_reward:"",need_allocate:""}),$=[{value:"1",text:"是"},{value:"0",text:"否"}],A=a=>a===1||a==="1"?"是":"否",R=a=>{o.id=a.rowData.id,o.real_power=a.rowData.real_power,o.real_reward=a.rowData.real_reward,o.need_allocate=a.rowData.need_allocate===1?"是":"否",b.value=!0},W=async()=>{var a;try{const e=await Z(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((a=o.need_allocate)==null?void 0:a.value)});w({message:e,color:"success"}),await y(),await f(),b.value=!1}catch(e){console.error("修改失败:",e),w({message:e.message||"修改失败",color:"danger"})}},j=()=>{b.value=!1,H()},H=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},Y=a=>{m.page=Math.ceil(a/m.pagesize),h.value=a,y(),f()},q=()=>{p.value=null,_.value="",d.value="",y(),f()};return y(),f(),(a,e)=>{const c=u("va-date-input"),r=u("va-select"),D=u("va-button"),E=u("va-button-group"),G=u("VaDataTable"),z=u("VaInput"),X=u("VaForm"),J=u("VaModal"),K=u("VaPagination"),L=u("va-card");return ne(),se(L,{class:"machines-list"},{default:s(()=>[V("div",ce,[V("div",de,[t(c,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":l=>!C(ae)(l)},null,8,["modelValue","allowed-days"]),t(r,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),options:O.value,placeholder:"币种筛选",class:"mr-5",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(r,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),options:x.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(D,{onClick:q,class:"",color:"rgb(47, 148, 172)"},{default:s(()=>e[8]||(e[8]=[i(" 刷新 ")])),_:1})])]),V("div",ie,[t(G,{items:k.value,columns:B,striped:"",class:"responsive-table"},{"cell(record_date)":s(({value:l})=>[i(v(l?l.split("T")[0]:""),1)]),"cell(power)":s(({value:l})=>[i(v(C(U)(l)),1)]),"cell(real_power)":s(({value:l})=>[i(v(C(U)(l)),1)]),"cell(need_allocate)":s(({value:l})=>[i(v(A(l)),1)]),"cell(pool_type)":s(({value:l})=>[i(v(F[l]||"未知"),1)]),"cell(actions)":s(({row:l})=>[t(E,null,{default:s(()=>[t(D,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:fe=>R(l)},null,8,["onClick"])]),_:2},1024)]),default:s(()=>[e[9]||(e[9]=i(" formatHashRate "))]),_:1},8,["items"]),t(J,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=l=>b.value=l),title:"修改记录",onCancel:j,onOk:W},{default:s(()=>[t(X,null,{default:s(()=>[t(z,{modelValue:o.real_power,"onUpdate:modelValue":e[3]||(e[3]=l=>o.real_power=l),label:"实际算力",type:"number",placeholder:"请输入实际算力",class:"mb-2"},null,8,["modelValue"]),t(z,{modelValue:o.real_reward,"onUpdate:modelValue":e[4]||(e[4]=l=>o.real_reward=l),label:"实际奖励",type:"number",placeholder:"请输入实际奖励",class:"mb-2"},null,8,["modelValue"]),t(r,{modelValue:o.need_allocate,"onUpdate:modelValue":e[5]||(e[5]=l=>o.need_allocate=l),label:"是否需要分配",options:$,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),V("div",pe,[t(K,{modelValue:h.value,"onUpdate:modelValue":[e[7]||(e[7]=l=>h.value=l),Y],"page-size":m.pagesize,"visible-pages":"5",total:g.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),V("span",me," 共 "+v(g.value)+" 条记录 ",1)])]),_:1})}}},ke=oe(ve,[["__scopeId","data-v-d0cf5f4d"]]);export{ke as default};
//# sourceMappingURL=node_revenue-DEJiFWo-.js.map
