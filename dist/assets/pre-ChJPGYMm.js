import{m as te,p as le,b as oe}from"./machines-qWh7tC1y.js";import{g as z,a as B,i as se,f as ne,b as re}from"./date-CMM1G54V.js";import{_ as ie,G as de,r as i,U as F,g as ue,w as s,f as d,a as W,b as k,i as u,h as o,u as m,t as v,c as me,k as ce,W as O}from"./index-D7A_F0Qb.js";import{u as pe}from"./useToast-DgA6W2hS.js";import"./request-DN7ZYJhW.js";const ve={class:"mb-4"},_e={class:"table-responsive"},be={key:0,class:"va-text-danger"},fe={class:"flex justify-end mt-4"},ge={class:"ml-4 self-center text-gray-600"},ye={__name:"pre",setup(Ve){const{t:n}=de(),{init:f}=pe(),I=[{value:"0",text:"是"},{value:"1",text:"否"}],D=i([]),c=i(z(8)),g=i(""),x=i(I[0]),w=i(D[0]),_=i(!1),l=F({id:null,online_points:0,hashrate:0,record_date:""}),p=i(""),A=a=>{const e=Number(a.data);console.log("num is",e),isNaN(e)?p.value="必须输入数字":Number.isInteger(e)?e<0||e>288?p.value="范围0~288":p.value="":p.value="必须为整数"},$=a=>a.map(e=>({value:e,text:e})),U=async()=>{try{const a=await te();D.value=$(a.groups||[])}catch(a){console.error("接口调用失败:",a)}},M=i(1),y=i(100),C=i([]),P=i(!1),V=F({page:1,pagesize:10}),E=[{key:"mid",label:n("admin.mid")},{key:"hostname",label:n("admin.mName")},{key:"record_date",label:n("admin.recordDate")},{key:"currency",label:n("admin.currency")},{key:"uid",label:n("admin.userUid")},{key:"sub_user_name",label:n("admin.subUserName")},{key:"online_time",label:n("admin.onlineTimes")},{key:"online_points",label:n("admin.onlinePoints")},{key:"hashrate",label:n("admin.avgHashrate")},{key:"is_in_black_list",label:n("admin.needAllocate")},{key:"group",label:n("admin.groupName")},{key:"actions",label:n("admin.operation")}],G=a=>{V.page=Math.ceil(a/V.pagesize),M.value=a,b()},S=a=>{if(!a)return"";const e=new Date(a),r=e.getFullYear(),N=String(e.getMonth()+1).padStart(2,"0"),h=String(e.getDate()).padStart(2,"0");return`${r}-${N}-${h}`},b=async()=>{var a;P.value=!0;try{const e={...V,is_in_black_list:x.value.value,hostname:g.value,group:(a=w.value)==null?void 0:a.value};c.value&&(e.record_date=S(c.value));const r=await le(e);r&&Array.isArray(r.machine_info)&&typeof r.total=="number"?(C.value=r.machine_info,y.value=r.total):r.machine_info===null?(C.value=[],y.value=0):f({message:"查询错误",color:"danger"})}catch(e){console.error("获取数据失败:",e),f({message:"获取数据失败",color:"danger"})}finally{P.value=!1}},H=()=>{b(),U()},L=a=>{l.id=a.rowData.id,l.hostname=a.rowData.hostname,l.online_points=a.rowData.online_points,l.hashrate=a.rowData.hashrate,l.record_date=B(a.rowData.record_date),_.value=!0},Y=a=>a===0||a==="0"?"是":"否",j=()=>{_.value=!1,J()},q=()=>{g.value="",c.value&&(c.value=S(z(8))),b(),U()},R=async()=>{try{console.log("record_date is",l.record_date);const a=await oe({hostname:l.hostname,record_date:l.record_date,online_points:l.online_points,hashrate:l.hashrate});f({message:a,color:"success"}),await b(),_.value=!1}catch(a){console.error("更新失败:",a),f({message:a,color:"danger"})}},J=()=>{l.id=null,l.online_points=0,l.hashrate=0};return b(),U(),(a,e)=>{const r=d("va-input"),N=d("va-date-input"),h=d("va-select"),K=d("va-button-group"),Q=d("VaDataTable"),T=d("VaInput"),X=d("VaForm"),Z=d("VaModal"),ee=d("VaPagination"),ae=d("va-card");return W(),ue(ae,{class:"machines-list"},{default:s(()=>[k("div",ve,[e[13]||(e[13]=u(" 机器名： ")),o(r,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"搜索机器名",class:"mb-1 mr-8",style:{maxWidth:"15%"}},{prepend:s(()=>e[10]||(e[10]=[])),_:1},8,["modelValue"]),e[14]||(e[14]=u(" 记录日期： ")),o(N,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),placeholder:"选择日期",class:"mb-1 mr-5",style:{maxWidth:"16%"},"allowed-days":t=>!m(se)(t)},null,8,["modelValue","allowed-days"]),e[15]||(e[15]=u(" 分组： ")),o(h,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),options:D.value,placeholder:"组名",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),e[16]||(e[16]=u(" 参与分配： ")),o(h,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),options:I,placeholder:"是否参与分配",class:"filter-item mb-1 mr-8",style:{maxWidth:"10%"}},null,8,["modelValue"]),o(m(O),{onClick:H,class:"mb-1 mr-8"},{default:s(()=>e[11]||(e[11]=[u(" 搜索 ")])),_:1}),o(m(O),{onClick:q,class:"mb-1 mr-8"},{default:s(()=>e[12]||(e[12]=[u(" 刷新 ")])),_:1})]),k("div",_e,[o(Q,{items:C.value,columns:E,striped:"",class:"responsive-table"},{"cell(created_time)":s(({value:t})=>[u(v(m(ne)(t)),1)]),"cell(hashrate)":s(({value:t})=>[u(v(m(re)(t)),1)]),"cell(record_date)":s(({value:t})=>[u(v(m(B)(t)),1)]),"cell(is_in_black_list)":s(({value:t})=>[u(v(Y(t)),1)]),"cell(actions)":s(({row:t})=>[o(K,null,{default:s(()=>[o(m(O),{small:"",icon:"edit",color:"primary",onClick:he=>L(t)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),o(Z,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=t=>_.value=t),title:"修改机器信息",onCancel:j,onOk:R},{default:s(()=>[o(X,null,{default:s(()=>[o(T,{modelValue:l.hostname,"onUpdate:modelValue":e[4]||(e[4]=t=>l.hostname=t),label:"机器名",class:"mb-2",readonly:""},null,8,["modelValue"]),o(T,{modelValue:l.record_date,"onUpdate:modelValue":e[5]||(e[5]=t=>l.record_date=t),label:"记录日期",class:"mb-2",readonly:""},null,8,["modelValue"]),o(r,{modelValue:l.online_points,"onUpdate:modelValue":e[6]||(e[6]=t=>l.online_points=t),label:"在线时长点数",type:"number",placeholder:"请输入0~288的整数",min:0,max:288,"selected-top-shown":"",class:"mb-2",onInput:A},{messages:s(()=>[p.value?(W(),me("div",be,v(p.value),1)):ce("",!0)]),_:1},8,["modelValue"]),o(T,{modelValue:l.hashrate,"onUpdate:modelValue":e[7]||(e[7]=t=>l.hashrate=t),label:"算力",type:"number",placeholder:"请输入算力",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),k("div",fe,[o(ee,{modelValue:M.value,"onUpdate:modelValue":[e[9]||(e[9]=t=>M.value=t),G],"page-size":V.pagesize,"visible-pages":"5",total:y.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),k("span",ge," 共 "+v(y.value)+" 条记录 ",1)])]),_:1})}}},Me=ie(ye,[["__scopeId","data-v-fb02d2b8"]]);export{Me as default};
//# sourceMappingURL=pre-ChJPGYMm.js.map
