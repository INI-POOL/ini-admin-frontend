import{m as te,p as oe,a as se}from"./machines-CXOeTK0j.js";import{g as W,c as F,i as ne,f as re,a as ie}from"./date-BcVh7cYI.js";import{_ as ue,G as de,r as s,U as A,B as me,g as ce,w as i,f as u,a as $,b as U,h as o,u as v,i as _,t as b,c as pe,k as ve,W as E}from"./index-BguglIgO.js";import{u as _e}from"./useToast-CsmT0Z1t.js";import"./request-Ba4b_24I.js";const be={class:"mb-4"},fe={class:"table-responsive"},ge={key:0,class:"va-text-danger"},he={class:"flex justify-end mt-4"},ye={class:"ml-4 self-center text-gray-600"},Ve={__name:"pre_machine",setup(ke){const{t:n}=de(),{init:D}=_e(),T=[{value:"0",text:"是"},{value:"1",text:"否"}],M=s([]),m=s(W(8)),f=s(""),c=s(T[0]),g=s(M[0]),h=s(""),I=s([]),y=s(!1),t=A({id:null,online_points:0,hashrate:0,record_date:""}),p=s(""),G=l=>{const e=Number(l.data);console.log("num is",e),isNaN(e)?p.value="必须输入数字":Number.isInteger(e)?e<0||e>288?p.value="范围0~288":p.value="":p.value="必须为整数"},z=l=>l.map(e=>({value:e,text:e})),B=async()=>{try{const l=await te(),e={value:"",text:"所有"};I.value=[e,...z(l.currencies||[])],M.value=[e,...z(l.groups||[])]}catch(l){console.error("接口调用失败:",l)}},x=s(1),w=s(100),C=s([]),P=s(!1),V=A({page:1,pagesize:10}),H=[{key:"mid",label:n("admin.mid")},{key:"hostname",label:n("admin.mName")},{key:"record_date",label:n("admin.recordDate")},{key:"currency",label:n("admin.currency")},{key:"uid",label:n("admin.userUid")},{key:"sub_user_name",label:n("admin.subUserName")},{key:"online_time",label:n("admin.onlineTimes")},{key:"online_points",label:n("admin.onlinePoints")},{key:"hashrate",label:n("admin.avgHashrate")},{key:"is_in_black_list",label:n("admin.needAllocate")},{key:"group",label:n("admin.groupName")},{key:"actions",label:n("admin.operation")}],Y=l=>{V.page=Math.ceil(l/V.pagesize),x.value=l,k()},S=l=>{if(!l)return"";const e=new Date(l),d=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),N=String(e.getDate()).padStart(2,"0");return`${d}-${r}-${N}`},k=async()=>{var l,e;P.value=!0;try{const d={...V,is_in_black_list:c.value.value,hostname:f.value,group:(l=g.value)==null?void 0:l.value,currency:(e=h.value)==null?void 0:e.value};m.value&&(d.record_date=S(m.value));const r=await oe(d);r&&Array.isArray(r.machine_info)&&typeof r.total=="number"?(C.value=r.machine_info,w.value=r.total):r.machine_info===null?(C.value=[],w.value=0):D({message:"查询错误",color:"danger"})}catch(d){console.error("获取数据失败:",d),D({message:"获取数据失败",color:"danger"})}finally{P.value=!1}};me([m,c,g,f,h],()=>{V.page=1,x.value=1,k()});const j=l=>{t.id=l.rowData.id,t.hostname=l.rowData.hostname,t.online_points=l.rowData.online_points,t.hashrate=l.rowData.hashrate,t.record_date=F(l.rowData.record_date),y.value=!0},q=l=>l===0||l==="0"?"是":"否",L=()=>{y.value=!1,K()},R=()=>{f.value="",g.value="",h.value="",c.value.value="0",c.value.text="是",m.value&&(m.value=S(W(8))),k(),B()},J=async()=>{try{console.log("record_date is",t.record_date);const l=await se({hostname:t.hostname,record_date:t.record_date,online_points:t.online_points,hashrate:t.hashrate});D({message:l,color:"success"}),await k(),y.value=!1}catch(l){console.error("更新失败:",l),D({message:l,color:"danger"})}},K=()=>{t.id=null,t.online_points=0,t.hashrate=0};return k(),B(),(l,e)=>{const d=u("va-input"),r=u("va-select"),N=u("va-date-input"),Q=u("va-button-group"),X=u("VaDataTable"),O=u("VaInput"),Z=u("VaForm"),ee=u("VaModal"),ae=u("VaPagination"),le=u("va-card");return $(),ce(le,{class:"machines-list"},{default:i(()=>[U("div",be,[o(d,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"搜索机器名",class:"mb-1 mr-8",style:{maxWidth:"13%"}},{prepend:i(()=>e[11]||(e[11]=[])),_:1},8,["modelValue"]),o(r,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),options:I.value,placeholder:"请选择币种",class:"mb-1 mr-8",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),o(N,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),placeholder:"选择日期",class:"mb-1 mr-8",style:{maxWidth:"16%"},"allowed-days":a=>!v(ne)(a)},null,8,["modelValue","allowed-days"]),o(r,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),options:M.value,placeholder:"组名",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),e[13]||(e[13]=_(" 参与分配： ")),o(r,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),options:T,placeholder:"是否参与分配",class:"filter-item mb-1 mr-8",style:{maxWidth:"10%"}},null,8,["modelValue"]),o(v(E),{onClick:R,class:"mb-1 mr-8",color:"rgb(47, 148, 172)"},{default:i(()=>e[12]||(e[12]=[_(" 刷新 ")])),_:1})]),U("div",fe,[o(X,{items:C.value,columns:H,striped:"",class:"responsive-table"},{"cell(created_time)":i(({value:a})=>[_(b(v(re)(a)),1)]),"cell(hashrate)":i(({value:a})=>[_(b(v(ie)(a)),1)]),"cell(record_date)":i(({value:a})=>[_(b(v(F)(a)),1)]),"cell(is_in_black_list)":i(({value:a})=>[_(b(q(a)),1)]),"cell(actions)":i(({row:a})=>[o(Q,null,{default:i(()=>[o(v(E),{size:"small",color:"rgb(47, 148, 172)",icon:"edit",onClick:De=>j(a)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),o(ee,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>y.value=a),title:"修改机器信息",onCancel:L,onOk:J},{default:i(()=>[o(Z,null,{default:i(()=>[o(O,{modelValue:t.hostname,"onUpdate:modelValue":e[5]||(e[5]=a=>t.hostname=a),label:"机器名",class:"mb-2",readonly:""},null,8,["modelValue"]),o(O,{modelValue:t.record_date,"onUpdate:modelValue":e[6]||(e[6]=a=>t.record_date=a),label:"记录日期",class:"mb-2",readonly:""},null,8,["modelValue"]),o(d,{modelValue:t.online_points,"onUpdate:modelValue":e[7]||(e[7]=a=>t.online_points=a),label:"在线时长点数",type:"number",placeholder:"请输入0~288的整数",min:0,max:288,"selected-top-shown":"",class:"mb-2",onInput:G},{messages:i(()=>[p.value?($(),pe("div",ge,b(p.value),1)):ve("",!0)]),_:1},8,["modelValue"]),o(O,{modelValue:t.hashrate,"onUpdate:modelValue":e[8]||(e[8]=a=>t.hashrate=a),label:"算力",type:"number",placeholder:"请输入算力",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),U("div",he,[o(ae,{modelValue:x.value,"onUpdate:modelValue":[e[10]||(e[10]=a=>x.value=a),Y],"page-size":V.pagesize,"visible-pages":"5",total:w.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),U("span",ye," 共 "+b(w.value)+" 条记录 ",1)])]),_:1})}}},Ne=ue(Ve,[["__scopeId","data-v-8287f190"]]);export{Ne as default};
//# sourceMappingURL=pre_machine-CviGhjIc.js.map
