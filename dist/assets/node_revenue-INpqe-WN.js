import{g as Q,a as Z,u as ee}from"./node-BvdNJqoa.js";import{m as ae}from"./machines-C826RHFd.js";import{i as le,a as U}from"./date-BcVh7cYI.js";import{u as oe}from"./useToast-D5Y7Ww6t.js";import{_ as te,r as u,U as S,B as se,g as re,w as r,X as ne,f as c,a as ue,b as w,h as t,u as C,i,t as v,Y as ce}from"./index-HvKrE3Lg.js";import"./request-DuxCp3v5.js";const de={class:"mb-4"},ie={class:"filters-row"},pe={class:"table-responsive"},me={class:"flex justify-end mt-4"},ve={class:"ml-4 self-center text-gray-600"},_e={__name:"node_revenue",setup(fe){const{init:V}=oe(),I=ne(),p=u(),d=u(""),O=u([]),x=u([]),_=u(x[0]),P=l=>l.map(e=>({value:e,text:e})),f=async()=>{try{const l=await ae(),e=await Q(),s={value:"",text:"所有"};O.value=[s,...P(e||[])],x.value=[s,...P(l.groups||[])]}catch(l){console.error("接口调用失败:",l)}},h=u(1),g=u(0),k=u([]),T=u(!1),m=S({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),M=l=>{if(!l)return"";const e=new Date(l),s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),D=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${D}`},y=async()=>{var l,e;T.value=!0;try{const s={page:m.page,pagesize:m.pagesize,currency:(l=d.value)==null?void 0:l.value,group:(e=_.value)==null?void 0:e.value};p.value&&(s.date=M(p.value));const n=await Z(s);n!=null&&n.pool_profits?(k.value=n.pool_profits,g.value=n.total):(k.value=[],g.value=0)}catch(s){console.error("获取数据失败:",s),V({message:s.message||"获取数据失败",color:"danger"}),k.value=[],g.value=0}finally{T.value=!1}},N=()=>{I.push({name:"tao_revenue"})};se([p,d,_],()=>{var l;if(m.page=1,h.value=1,console.log("searchCurrency.value is",d.value),((l=d.value)==null?void 0:l.value)==="tao"){V({message:"",color:"info",duration:5e3,render:()=>ce("a",{href:"javascript:void(0);",style:"color: #fff; text-decoration: underline;",onClick:()=>N()},"请去TAO收益页面查看")});return}y(),f()});const F={0:"未知",1:"zkwork",2:"oula",3:"daxiang",4:"f2pool"},B=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"reward",label:"奖励"},{key:"real_reward",label:"实际奖励"},{key:"power",label:"算力"},{key:"real_power",label:"实际算力"},{key:"currency",label:"币种"},{key:"pool_type",label:"矿池类型"},{key:"group",label:"分组"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],b=u(!1),o=S({id:null,real_power:"",real_reward:"",need_allocate:""}),R=[{value:"1",text:"是"},{value:"0",text:"否"}],$=l=>l===1||l==="1"?"是":"否",A=l=>{o.id=l.rowData.id,o.real_power=l.rowData.real_power,o.real_reward=l.rowData.real_reward,o.need_allocate=l.rowData.need_allocate===1?"是":"否",b.value=!0},W=async()=>{var l;try{const e=await ee(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((l=o.need_allocate)==null?void 0:l.value)});V({message:e,color:"success"}),await y(),await f(),b.value=!1}catch(e){console.error("修改失败:",e),V({message:e.message||"修改失败",color:"danger"})}},j=()=>{b.value=!1,H()},H=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},Y=l=>{m.page=Math.ceil(l/m.pagesize),h.value=l,y(),f()},q=()=>{p.value=null,_.value="",d.value="",y(),f()};return y(),f(),(l,e)=>{const s=c("va-date-input"),n=c("va-select"),D=c("va-button"),E=c("va-button-group"),G=c("VaDataTable"),z=c("VaInput"),X=c("VaForm"),J=c("VaModal"),K=c("VaPagination"),L=c("va-card");return ue(),re(L,{class:"machines-list"},{default:r(()=>[w("div",de,[w("div",ie,[t(s,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":a=>!C(le)(a)},null,8,["modelValue","allowed-days"]),t(n,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),options:O.value,placeholder:"币种筛选",class:"mr-5",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(n,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),options:x.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(D,{onClick:q,class:"",color:"rgb(47, 148, 172)"},{default:r(()=>e[8]||(e[8]=[i(" 刷新 ")])),_:1})])]),w("div",pe,[t(G,{items:k.value,columns:B,striped:"",class:"responsive-table"},{"cell(record_date)":r(({value:a})=>[i(v(a?a.split("T")[0]:""),1)]),"cell(power)":r(({value:a})=>[i(v(C(U)(a)),1)]),"cell(real_power)":r(({value:a})=>[i(v(C(U)(a)),1)]),"cell(need_allocate)":r(({value:a})=>[i(v($(a)),1)]),"cell(pool_type)":r(({value:a})=>[i(v(F[a]||"未知"),1)]),"cell(actions)":r(({row:a})=>[t(E,null,{default:r(()=>[t(D,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:ge=>A(a)},null,8,["onClick"])]),_:2},1024)]),default:r(()=>[e[9]||(e[9]=i(" formatHashRate "))]),_:1},8,["items"]),t(J,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),title:"修改记录",onCancel:j,onOk:W},{default:r(()=>[t(X,null,{default:r(()=>[t(z,{modelValue:o.real_power,"onUpdate:modelValue":e[3]||(e[3]=a=>o.real_power=a),label:"实际算力",type:"number",placeholder:"请输入实际算力",class:"mb-2"},null,8,["modelValue"]),t(z,{modelValue:o.real_reward,"onUpdate:modelValue":e[4]||(e[4]=a=>o.real_reward=a),label:"实际奖励",type:"number",placeholder:"请输入实际奖励",class:"mb-2"},null,8,["modelValue"]),t(n,{modelValue:o.need_allocate,"onUpdate:modelValue":e[5]||(e[5]=a=>o.need_allocate=a),label:"是否需要分配",options:R,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),w("div",me,[t(K,{modelValue:h.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>h.value=a),Y],"page-size":m.pagesize,"visible-pages":"5",total:g.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),w("span",ve," 共 "+v(g.value)+" 条记录 ",1)])]),_:1})}}},De=te(_e,[["__scopeId","data-v-b5ca5054"]]);export{De as default};
//# sourceMappingURL=node_revenue-INpqe-WN.js.map
