import{g as J,u as K}from"./node-DqdoXN_X.js";import{m as L}from"./machines-CCecCB1s.js";import{i as Q}from"./date-3l_ArPo2.js";import{u as R}from"./useToast-DIg0v8p3.js";import{_ as X,r as s,U as z,B as Z,g as ee,w as c,f as n,a as ae,b as f,h as l,u as te,i as D,t as x}from"./index-BdN10sHv.js";import"./request-CBHSDB4H.js";const oe={class:"mb-4"},le={class:"filters-row"},se={class:"table-responsive"},ne={class:"flex justify-end mt-4"},re={class:"ml-4 self-center text-gray-600"},ce={__name:"tao_revenue",setup(ue){const{init:w}=R(),u=s(),i=s(),P=s(""),h=s([]),p=s(h[0]),S=a=>a.map(e=>({value:e,text:e})),m=async()=>{try{const a=await L("tao"),e={value:"",text:"所有"};h.value=[e,...S(a.groups||[])]}catch(a){console.error("接口调用失败:",a)}},y=s(1),_=s(0),b=s([]),C=s(!1),d=z({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),T=a=>{if(!a)return"";const e=new Date(a),r=e.getFullYear(),k=String(e.getMonth()+1).padStart(2,"0"),V=String(e.getDate()).padStart(2,"0");return`${r}-${k}-${V}`},v=async()=>{var a;C.value=!0;try{const e={page:d.page,pagesize:d.pagesize,currency:"tao",group:(a=p.value)==null?void 0:a.value,hotkey:i.value};u.value&&(e.date=T(u.value));const r=await J(e);r!=null&&r.pool_profits?(b.value=r.pool_profits,_.value=r.total):(b.value=[],_.value=0)}catch(e){console.error("获取数据失败:",e),w({message:e.message||"获取数据失败",color:"danger"}),b.value=[],_.value=0}finally{C.value=!1}};Z([u,P,p,i],()=>{d.page=1,y.value=1,v(),m()});const U=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"hotkey",label:"Hotkey",width:"520px"},{key:"network",label:"网络"},{key:"subnet",label:"子网"},{key:"profit",label:"收益"},{key:"created_date",label:"地址创建日期"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],g=s(!1),o=z({id:null,real_power:"",real_reward:"",need_allocate:""}),M=[{value:"1",text:"是"},{value:"0",text:"否"}],N=a=>a===1||a==="1"?"是":"否",F=a=>{o.id=a.rowData.id,o.real_power=a.rowData.real_power,o.real_reward=a.rowData.real_reward,o.need_allocate=a.rowData.need_allocate===1?"是":"否",g.value=!0},I=async()=>{var a;try{const e=await K(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((a=o.need_allocate)==null?void 0:a.value)});w({message:e,color:"success"}),await v(),await m(),g.value=!1}catch(e){console.error("修改失败:",e),w({message:e.message||"修改失败",color:"danger"})}},B=()=>{g.value=!1,$()},$=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},W=a=>{d.page=Math.ceil(a/d.pagesize),y.value=a,v(),m()},H=()=>{u.value=null,p.value="",P.value="",i.value="",v(),m()};return v(),m(),(a,e)=>{const r=n("va-input"),k=n("va-date-input"),V=n("va-select"),O=n("va-button"),j=n("va-button-group"),q=n("VaDataTable"),A=n("VaForm"),E=n("VaModal"),G=n("VaPagination"),Y=n("va-card");return ae(),ee(Y,{class:"machines-list"},{default:c(()=>[f("div",oe,[f("div",le,[l(r,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),placeholder:"搜索地址名",class:"mr-5",style:{maxWidth:"13%"}},{prepend:c(()=>e[6]||(e[6]=[])),_:1},8,["modelValue"]),l(k,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":t=>!te(Q)(t)},null,8,["modelValue","allowed-days"]),l(V,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),options:h.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),l(O,{onClick:H,class:"",color:"rgb(47, 148, 172)"},{default:c(()=>e[7]||(e[7]=[D(" 重置 ")])),_:1})])]),f("div",se,[l(q,{items:b.value,columns:U,striped:"",class:"responsive-table"},{"cell(record_date)":c(({value:t})=>[D(x(t?t.split("T")[0]:""),1)]),"cell(need_allocate)":c(({value:t})=>[D(x(N(t)),1)]),"cell(actions)":c(({row:t})=>[l(j,null,{default:c(()=>[l(O,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:de=>F(t)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),l(E,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),title:"修改记录",onCancel:B,onOk:I},{default:c(()=>[l(A,null,{default:c(()=>[l(V,{modelValue:o.need_allocate,"onUpdate:modelValue":e[3]||(e[3]=t=>o.need_allocate=t),label:"是否需要分配",options:M,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),f("div",ne,[l(G,{modelValue:y.value,"onUpdate:modelValue":[e[5]||(e[5]=t=>y.value=t),W],"page-size":d.pagesize,"visible-pages":"5",total:_.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),f("span",re," 共 "+x(_.value)+" 条记录 ",1)])]),_:1})}}},fe=X(ce,[["__scopeId","data-v-2343d0de"]]);export{fe as default};
//# sourceMappingURL=tao_revenue-Bzr0ijJL.js.map
