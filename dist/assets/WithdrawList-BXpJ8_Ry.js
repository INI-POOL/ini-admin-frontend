import{u as me}from"./useToast-D8MyLy3n.js";import{p as O,g as ve}from"./request-CyVb8btO.js";import{f as R}from"./date-CMM1G54V.js";import{a as pe}from"./user-CMBUKRAc.js";import{_ as _e,U as q,r as v,o as fe,c as z,b as t,t as r,h as o,w as l,I as ge,f as u,a as c,i,u as V,g as f,k as U}from"./index-CVBAPNBq.js";function ye(k){return O("/api/v1/back_stage/withdraw/list",k)}function be(k){return O("/api/v1/back_stage/withdraw/audit",k)}function Ve(){return ve("/api/v1/back_stage/hot_address/balance")}function T(k){let d=k.toString();return d.includes(".")&&(d=d.replace(/\.?0+$/,"")),d}const ke={class:"withdraw-list"},xe={class:"mb-4"},we={class:"text-2xl font-bold"},Ce=["onClick"],De={class:"action-buttons",style:{"text-align":"center"}},ze={key:2},Te={class:"flex justify-end mt-4"},Ae={class:"ml-4 self-center text-gray-600"},Be={key:0,class:"text-center p-4"},Ue={key:1},$e={class:"grid grid-cols-2 gap-4"},Ie={key:2,class:"text-danger p-4"},Se={class:"space-y-4"},Pe={class:"mb-4"},We={class:"transfer-header",style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column",gap:"0.62rem","padding-top":"1rem"}},he={class:"status"},Me={class:"time"},Ne={class:"transfer-info"},Le={class:"info-row"},je={class:"value-box"},Ee={class:"value"},Fe={class:"info-row"},He={class:"value-box"},Re={class:"value"},qe={class:"info-row"},Oe={class:"value-box"},Ze={class:"info-row"},Ge={class:"value-box"},Je={class:"transaction-id"},Ke={class:"value-box"},Qe={class:"value"},Xe=["href"],Ye={__name:"WithdrawList",setup(k){const{init:d}=me(),Z=[{key:"id",label:"订单号"},{key:"uid",label:"用户编号"},{key:"mobile",label:"手机号"},{key:"amount",label:"提现金额"},{key:"gas_fee",label:"gas费"},{key:"currency",label:"币种"},{key:"status",label:"提现状态"},{key:"audit_status",label:"审核状态",sortable:!0},{key:"created_time",label:"申请时间",sortable:!0},{key:"action",label:"操作"}],x=q({page:1,pagesize:10}),L=v([]),A=v(0),$=v(1),I=v(!1),S=async()=>{I.value=!0;try{const a=await ye(x);a&&typeof a.Total=="number"?(L.value=a.Withdraws||[],A.value=parseInt(a.Total)):(console.error("API返回数据格式错误:",a),d({message:"数据格式错误",color:"danger"}))}catch(a){console.error("获取数据失败:",a),d({message:"获取数据失败",color:"danger"})}finally{I.value=!1}},w=async a=>{if(navigator.clipboard)navigator.clipboard.writeText(a).then(()=>{d({message:"复制成功",color:"success"})}).catch(e=>{d({message:"复制成功",color:"success"})});else{const e=document.createElement("textarea");e.value=a,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),d({message:"复制成功",color:"success"})}},G=a=>{x.page=Math.ceil(a/x.pagesize),$.value=a,S()},j=(a,e)=>{const m={0:"处理中",1:"成功",2:"失败",3:"确认中",4:"提现异常"};return console.log(a,e),a==2&&e>15?"Aleo网络异常":m[a]||"未知状态"},J=a=>{const e={0:"warning",1:"success",2:"info",3:"danger"};let m=e[a]||"primary";return console.log(e[a]),m},K=a=>({0:"待审核",1:"已通过",2:"未通过"})[a]||"未知状态",Q=a=>({0:"warning",1:"success",2:"danger"})[a]||"primary",B=v(!1),C=v(null),p=q({audit_status:1}),P=v(!1),W=v(!1),_=v(null),X=a=>{a&&(C.value=a.rowData,p.audit_status=1,B.value=!0)},Y=async a=>{console.log("row is",a),P.value=!0,W.value=!0;let e={page:1,pagesize:10,uid:a.uid,currency:a.currency};try{const m=await pe(e);console.log("response is",m),_.value=m==null?void 0:m[0]}catch(m){console.error("获取用户详情失败:",m),_.value=null}finally{W.value=!1}},ee=async()=>{if(!C.value)return;let a=ge();if(!p.google_code){d({message:"谷歌认证码不能为空",color:"danger"});return}try{let e=await be({id:C.value.id,audit_status:p.audit_status,google_code:p.google_code,user_name:a});console.log("data is",e),e==0?d({message:"审核失败, 余额不足",color:"warning"}):(d({message:"审核成功",color:"success"}),B.value=!1,S())}catch(e){d({message:e,color:"danger"})}},h=v(!1),n=v(null),te=a=>{if(!a){console.error("行数据为空");return}n.value=a.rowData,p.audit_status=1,h.value=!0},E=v(0),ae=async()=>{try{const a=await Ve();a?E.value=parseFloat(a):console.error("热钱包余额获取失败:",a)}catch(a){console.error("热钱包余额获取失败:",a)}};return fe(()=>{S(),ae()}),(a,e)=>{const m=u("VaBadge"),F=u("VaButton"),se=u("VaDataTable"),le=u("VaPagination"),oe=u("VaCardContent"),ne=u("VaCard"),re=u("VaProgressCircle"),g=u("va-text"),ie=u("va-card-content"),ue=u("va-card"),M=u("VaModal"),de=u("VaRadio"),ce=u("VaInput"),D=u("VaAvatar"),H=u("VaDivider"),N=u("VaIcon");return c(),z("div",ke,[t("div",xe,[t("h1",we,"提现管理  (热钱包余额："+r(E.value||0)+")",1)]),o(ne,null,{default:l(()=>[o(oe,null,{default:l(()=>[o(se,{items:L.value,loading:I.value,columns:Z,"items-per-page":x.pagesize,"current-page":x.page,"total-items":A.value,selectable:!1,"show-select":!1,hoverable:"",class:"responsive-table"},{"cell(amount)":l(({value:s})=>[i(r(V(T)(s)),1)]),"cell(gas_fee)":l(({value:s})=>[i(r(V(T)(s)),1)]),"cell(uid)":l(({row:s})=>[t("span",{class:"text-primary cursor-pointer hover:underline",onClick:y=>Y(s.rowData)},r(s.rowData.uid),9,Ce)]),"cell(status)":l(({row:s})=>[o(m,{color:J(s.rowData.status)},{default:l(()=>[i(r(j(s.rowData.status,s.rowData.id)),1)]),_:2},1032,["color"])]),"cell(audit_status)":l(({value:s})=>[o(m,{color:Q(s)},{default:l(()=>[i(r(K(s)),1)]),_:2},1032,["color"])]),"cell(created_time)":l(({value:s})=>[i(r(V(R)(s)),1)]),"cell(action)":l(({row:s})=>[t("div",De,[s?(c(),f(F,{key:0,size:"small",preset:"primary",onClick:y=>te(s)},{default:l(()=>e[11]||(e[11]=[i(" 查看 ")])),_:2},1032,["onClick"])):U("",!0),s&&Number(s.rowData.audit_status)===0?(c(),f(F,{key:1,size:"small",preset:"primary",onClick:y=>X(s)},{default:l(()=>e[12]||(e[12]=[i(" 审核 ")])),_:2},1032,["onClick"])):(c(),z("span",ze,"--"))])]),_:1},8,["items","loading","items-per-page","current-page","total-items"]),t("div",Te,[o(le,{modelValue:$.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>$.value=s),G],"page-size":x.pagesize,"visible-pages":"5",total:A.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),t("span",Ae," 共 "+r(A.value)+" 条记录 ",1)])]),_:1})]),_:1}),o(M,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s),title:"用户详情",size:"medium","hide-default-actions":""},{default:l(()=>[W.value?(c(),z("div",Be,[o(re,{indeterminate:""})])):_.value?(c(),z("div",Ue,[o(ue,{class:"mb-1"},{default:l(()=>[o(ie,null,{default:l(()=>[t("div",$e,[t("div",null,[o(g,{class:"font-bold"},{default:l(()=>e[13]||(e[13]=[i("总收益：")])),_:1}),o(g,null,{default:l(()=>[i(r((_.value.balance_amount||0)+(_.value.total_withdraw_pending||0)+(_.value.total_withdraw_completed||0)),1)]),_:1}),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=t("br",null,null,-1)),o(g,{class:"font-bold"},{default:l(()=>e[14]||(e[14]=[i("可用余额：")])),_:1}),o(g,null,{default:l(()=>[i(r(_.value.balance_amount||0),1)]),_:1}),e[19]||(e[19]=t("br",null,null,-1)),e[20]||(e[20]=t("br",null,null,-1)),o(g,{class:"font-bold"},{default:l(()=>e[15]||(e[15]=[i("冻结 (提现中)：")])),_:1}),o(g,null,{default:l(()=>[i(r(_.value.total_withdraw_pending||0),1)]),_:1}),e[21]||(e[21]=t("br",null,null,-1)),e[22]||(e[22]=t("br",null,null,-1)),o(g,{class:"font-bold"},{default:l(()=>e[16]||(e[16]=[i("已提现 (含手续费)：")])),_:1}),o(g,null,{default:l(()=>[i(r(_.value.total_withdraw_completed||0),1)]),_:1})])])]),_:1})]),_:1})])):(c(),z("div",Ie," 数据加载失败，请重试。 "))]),_:1},8,["modelValue"]),o(M,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=s=>B.value=s),title:"提现审核","ok-text":"确认","cancel-text":"取消",size:"small",class:"audit-modal",onOk:ee},{default:l(()=>{var s,y;return[t("div",Se,[t("div",null,[t("div",Pe," 当前提现金额："+r(V(T)((s=C.value)==null?void 0:s.amount)||0)+" "+r(((y=C.value)==null?void 0:y.currency)||""),1),e[23]||(e[23]=t("div",{class:"mb-2"},"审核结果",-1)),o(de,{modelValue:p.audit_status,"onUpdate:modelValue":e[2]||(e[2]=b=>p.audit_status=b),options:[{text:"同意",value:1},{text:"拒绝",value:2}],"value-by":"value"},null,8,["modelValue"]),e[24]||(e[24]=t("div",{class:"mb-2",style:{"padding-top":"0.62rem"}},"谷歌认证",-1)),o(ce,{modelValue:p.google_code,"onUpdate:modelValue":e[3]||(e[3]=b=>p.google_code=b),width:"200px",placeholder:"请输入谷歌认证码"},null,8,["modelValue"])])])]}),_:1},8,["modelValue"]),o(M,{modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=s=>h.value=s),title:"转账详情",size:"medium",class:"mr-6 my-1","close-button":""},{content:l(()=>{var s,y;return[t("div",We,[n.value.status===0?(c(),f(D,{key:0,color:"info"},{default:l(()=>e[25]||(e[25]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," more_horiz ",-1)])),_:1})):n.value.status===1?(c(),f(D,{key:1,color:"success"},{default:l(()=>e[26]||(e[26]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," check ",-1)])),_:1})):n.value.status===2?(c(),f(D,{key:2,color:"danger"},{default:l(()=>e[27]||(e[27]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," close ",-1)])),_:1})):n.value.status===3?(c(),f(D,{key:3,color:"warning"},{default:l(()=>e[28]||(e[28]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," directory_sync ",-1)])),_:1})):n.value.status===4?(c(),f(D,{key:4,color:"danger"},{default:l(()=>e[29]||(e[29]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," check ",-1)])),_:1})):U("",!0),t("div",he,r(j(n.value.status,n.value.id)),1),t("div",Me,r(V(R)(n.value.created_time)),1)]),o(H),t("div",Ne,[t("div",Le,[e[30]||(e[30]=t("span",{class:"label"},"数额：",-1)),t("div",je,[t("span",Ee,r(V(T)((s=n.value)==null?void 0:s.amount)||0)+" "+r(n.value.currency),1)])]),t("div",Fe,[e[31]||(e[31]=t("span",{class:"label"},"提款手续费：",-1)),t("div",He,[t("span",Re,r(V(T)((y=n.value)==null?void 0:y.gas_fee)||0)+" "+r(n.value.currency),1)])]),t("div",qe,[e[33]||(e[33]=t("span",{class:"label"},"收款地址：",-1)),t("div",Oe,[t("span",{class:"value",onClick:e[5]||(e[5]=b=>w(n.value.to_addr))},r(n.value.to_addr),1),o(N,{class:"material-icons",onClick:e[6]||(e[6]=b=>w(n.value.to_addr))},{default:l(()=>e[32]||(e[32]=[i(" content_copy ")])),_:1})])]),t("div",Ze,[e[35]||(e[35]=t("span",{class:"label"},"付款地址：",-1)),t("div",Ge,[t("span",{class:"value",onClick:e[7]||(e[7]=b=>w(n.value.from_addr))},r(n.value.from_addr),1),n.value.from_addr?(c(),f(N,{key:0,class:"material-icons",onClick:e[8]||(e[8]=b=>w(n.value.from_addr))},{default:l(()=>e[34]||(e[34]=[i(" content_copy ")])),_:1})):U("",!0)])])]),o(H),t("div",Je,[e[37]||(e[37]=t("span",{class:"label"},"交易号：",-1)),t("div",Ke,[t("span",Qe,[t("a",{href:`https://mainnet.aleo123.io/transactionDetail/${n.value.tx_id}`,target:"_blank"},r(n.value.tx_id),9,Xe)]),n.value.tx_id?(c(),f(N,{key:0,class:"material-icons",onClick:e[9]||(e[9]=b=>w(n.value.tx_id))},{default:l(()=>e[36]||(e[36]=[i(" content_copy ")])),_:1})):U("",!0)])])]}),_:1},8,["modelValue"])])}}},ot=_e(Ye,[["__scopeId","data-v-31669cdd"]]);export{ot as default};
//# sourceMappingURL=WithdrawList-BXpJ8_Ry.js.map
