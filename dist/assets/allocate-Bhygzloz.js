import{m as P}from"./machines-BxmdfteP.js";import{b as I}from"./allocate-Bm6uj41l.js";import{g as N,i as $,t as F}from"./date-CMM1G54V.js";import{u as W}from"./useToast-FctfAaky.js";import{_ as Y,r as s,U as w,B as j,g as q,w as d,f as m,a as G,b as f,i as c,h as y,u as D,t as v}from"./index-B3aTDmKr.js";import"./request-B9dpD8q3.js";const A={class:"mb-4"},E={class:"table-responsive"},H={class:"flex justify-end mt-4"},J={class:"ml-4 self-center text-gray-600"},K={__name:"allocate",setup(L){const{init:k}=W(),i=s(N(8)),h=s("");s(""),s([{value:"hashrate",text:"算力"},{value:"time",text:"时长"}]);const V=s([]),u=s(""),_=s(1),p=s(0),g=s([]),x=s(!1),n=w({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:"aleo"});s(!1),s(null);const T=t=>t.map(e=>({value:e,text:e})),S=async()=>{try{const t=await P(),e={value:"",text:"所有"};V.value=[e,...T(t.groups||[])]}catch(t){console.error("接口调用失败:",t)}},z=t=>{if(!t)return"";const e=new Date(t),r=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${r}-${l}-${o}`},b=async()=>{var t,e,r;x.value=!0;try{const l={page:n.page,pagesize:n.pagesize,date:n.date,currency:((t=h.value)==null?void 0:t.value)||"aleo"};i.value&&(l.date=z(i.value)),(e=u.value)!=null&&e.value&&(l.group=(r=u.value)==null?void 0:r.value);const o=await I(l);o!=null&&o.user_profits?(g.value=o.user_profits,p.value=o.total):(g.value=[],p.value=0)}catch(l){console.error("获取数据失败:",l),k({message:l.message||"获取数据失败",color:"danger"}),g.value=[],p.value=0}finally{x.value=!1}};j([i,h,u],()=>{n.page=1,_.value=1,b()});const O={0:"未开始",1:"已完成",2:"已失败"},U=[{key:"record_date",label:"记录日期"},{key:"uid",label:"用户Uid"},{key:"sub_user_name",label:"子账户"},{key:"machines",label:"机器数"},{key:"profit",label:"分配收益"},{key:"fee",label:"手续费"},{key:"group",label:"组名"},{key:"created_time",label:"分配时间"}];s(!1),w({id:null,real_power:"",real_reward:"",need_allocate:""});const B=t=>{n.page=Math.ceil(t/n.pagesize),_.value=t,b()};return b(),S(),(t,e)=>{const r=m("va-date-input"),l=m("va-select"),o=m("VaDataTable"),C=m("VaPagination"),M=m("va-card");return G(),q(M,{class:"machines-list"},{default:d(()=>[f("div",A,[e[3]||(e[3]=c(" 选择日期： ")),y(r,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),placeholder:"选择日期",class:"mb-1 mr-5",style:{maxWidth:"20%"},"allowed-days":a=>!D($)(a)},null,8,["modelValue","allowed-days"]),e[4]||(e[4]=c(" 分组： ")),y(l,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value=a),options:V.value,placeholder:"组名",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"])]),f("div",E,[y(o,{items:g.value,columns:U,striped:"",class:"responsive-table"},{"cell(record_date)":d(({value:a})=>[c(v(a?a.split("T")[0]:""),1)]),"cell(need_allocate)":d(({value:a})=>[c(v(a===1?"是":"否"),1)]),"cell(status)":d(({value:a})=>[c(v(O[a]),1)]),"cell(created_time)":d(({value:a})=>[c(v(D(F)(a)),1)]),_:1},8,["items"])]),f("div",H,[y(C,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>_.value=a),B],"page-size":n.pagesize,"visible-pages":"5",total:p.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),f("span",J," 共 "+v(p.value)+" 条记录 ",1)])]),_:1})}}},te=Y(K,[["__scopeId","data-v-07e69f41"]]);export{te as default};
//# sourceMappingURL=allocate-Bhygzloz.js.map
