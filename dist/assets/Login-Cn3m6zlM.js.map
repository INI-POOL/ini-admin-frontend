{"version":3,"file":"Login-Cn3m6zlM.js","sources":["../../src/pages/auth/Login.vue"],"sourcesContent":["<template>\n  <VaForm ref=\"form\" @submit.prevent=\"submit\">\n    <h1 class=\"font-semibold text-4xl mb-4\">登陆</h1>\n\n    <VaInput\n      v-model=\"formData.username\"\n      :rules=\"[validators.required, validators.username]\"\n      class=\"mb-4\"\n      label=\"用户名\"\n      type=\"text\"\n      @input=\"checkIsNeedGoogleCode\"\n    />\n    <VaValue v-slot=\"isPasswordVisible\" :default-value=\"false\">\n      <VaInput\n        v-model=\"formData.password\"\n        :rules=\"[validators.required]\"\n        :type=\"isPasswordVisible.value ? 'text' : 'password'\"\n        class=\"mb-4\"\n        label=\"密码\"\n        @clickAppendInner.stop=\"\n          isPasswordVisible.value = !isPasswordVisible.value\n        \"\n      >\n        <template #appendInner>\n          <VaIcon\n            :name=\"\n              isPasswordVisible.value ? 'mso-visibility_off' : 'mso-visibility'\n            \"\n            class=\"cursor-pointer\"\n            color=\"secondary\"\n          />\n        </template>\n      </VaInput>\n    </VaValue>\n\n    <VaInput\n      v-if=\"isGoogle\"\n      v-model=\"formData.google_code\"\n      class=\"mb-4\"\n      label=\"谷歌验证码\"\n      type=\"text\"\n    />\n\n    <div class=\"flex justify-center mt-4\">\n      <VaButton class=\"w-full\" @click=\"submit\"> 登陆</VaButton>\n    </div>\n  </VaForm>\n</template>\n\n<script lang=\"ts\" setup>\nimport { reactive, ref,onMounted } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport { useForm, useToast } from \"vuestic-ui\";\nimport { validators } from \"../../services/utils\";\n// import { login } from '../../api/user'\nimport { setToken,setUser} from \"../../utils/auth\";\nimport { generateToken } from \"../../services/utils\";\nimport {checkGoogleCode,isNeedGoogle} from \"../../api/user\";\n\n// const { validate } = useForm(\"form\");\nconst { push } = useRouter();\nconst { init } = useToast();\nconst isGoogle=ref(false)// 判断用户是否有谷歌认证\nconst umpoolISGoogle=ref(0)// 判断umpool是否有谷歌认证\n\nconst formData = reactive({\n  username: \"\",\n  password: \"\",\n  google_code:\"\",\n  keepLoggedIn: false,\n});\n\nconst checkIsNeedGoogleCode = () => {\n  if(formData.username.trim() === \"umpool\" && umpoolISGoogle.value===1 ){\n    isGoogle.value=true // 默认为true\n  }else{\n    isGoogle.value=false\n  }  \n} \n\nonMounted(async () => {\n  await checkUserGoogleCode();\n});\nconst checkUserGoogleCode = async () => {\n  try {\n    const res = await isNeedGoogle('umpool');\n    umpoolISGoogle.value = res;\n  } catch (error) {\n    console.error(\"Error checking Google code requirement:\", error);\n  }\n}\n\n\nconst submit = () => {\n  if(isGoogle.value===true && formData.google_code==\"\"){\n    init({ message: \"谷歌认证码不能为空\", color: \"danger\" });\n    return;\n  }\n  if(formData.username.trim() === \"umpool\" && formData.password.trim() === \"gT9@pY6uV*2S\" && isGoogle.value===true ){\n    checkGoogleCode({\"user_name\":formData.username, \"google_code\":formData.google_code}).then(res => {  \n      if(res===1){\n        const token = generateToken();\n        setToken(token);\n        setUser(formData.username);\n        init({ message: \"登陆成功！\", color: \"success\" });\n        push({ name: \"withdraw\" });\n      }else{\n        init({ message: \"谷歌认证码错误\", color: \"danger\" });\n      }\n    }).catch(err => {   \n      if(err.response){  \n        init({ message: err.response.data.msg, color: \"danger\" });\n      }else{\n        init({ message: \"无效参数\", color: \"danger\" }); \n      }\n    }) \n  }\n  else if (\n    (formData.username.trim() === \"admin\" &&\n    formData.password.trim() === \"A3f!7#b2Pz9L\") ||  (formData.username === \"umpool\" &&\n    formData.password === \"gT9@pY6uV*2S\")\n  ) {\n    const token = generateToken();\n    setToken(token);\n    setUser(formData.username);\n  \n    init({ message: \"登陆成功！\", color: \"success\" });\n    push({ name: \"withdraw\" });\n  } else {\n    init({ message: \"登陆失败！\", color: \"error\" });\n  }\n};\n\n// const handleLogin = async () => {\n//   const res = await login(formData)\n//   if (res.token) {\n//     setToken(res.token)\n//     push({ name: 'dashboard' })\n//   }\n// }\n\n/* ******接口调用******* */\n// export default defineComponent({\n//   setup() {\n//     const router = useRouter()\n//     const route = useRoute()\n\n//     const handleLogin = async (formData: any) => {\n//       try {\n//         const res = await login(formData)\n//         if (res.token) {\n//           setToken(res.token)\n//           // 获取重定向地址或默认跳转到首页\n//           const redirectPath = route.query.redirect as string || '/'\n//           router.push(redirectPath)\n//         }\n//       } catch (error) {\n//         console.error('登录失败:', error)\n//       }\n//     }\n\n//     return {\n//       handleLogin\n//     }\n//   }\n// })\n</script>\n"],"names":["push","useRouter","init","useToast","isGoogle","ref","umpoolISGoogle","formData","reactive","checkIsNeedGoogleCode","onMounted","checkUserGoogleCode","res","isNeedGoogle","error","submit","checkGoogleCode","token","generateToken","setToken","setUser","err"],"mappings":"sYA4DM,KAAA,CAAE,KAAAA,GAASC,IACX,CAAE,KAAAC,GAASC,IACXC,EAASC,EAAI,EAAK,EAClBC,EAAeD,EAAI,CAAC,EAEpBE,EAAWC,EAAS,CACxB,SAAU,GACV,SAAU,GACV,YAAY,GACZ,aAAc,EAAA,CACf,EAEKC,EAAwB,IAAM,CAC/BF,EAAS,SAAS,KAAA,IAAW,UAAYD,EAAe,QAAQ,EACjEF,EAAS,MAAM,GAEfA,EAAS,MAAM,EACjB,EAGFM,EAAU,SAAY,CACpB,MAAMC,EAAoB,CAAA,CAC3B,EACD,MAAMA,EAAsB,SAAY,CAClC,GAAA,CACI,MAAAC,EAAM,MAAMC,EAAa,QAAQ,EACvCP,EAAe,MAAQM,QAChBE,EAAO,CACN,QAAA,MAAM,0CAA2CA,CAAK,CAChE,CAAA,EAIIC,EAAS,IAAM,CACnB,GAAGX,EAAS,QAAQ,IAAQG,EAAS,aAAa,GAAG,CACnDL,EAAK,CAAE,QAAS,YAAa,MAAO,QAAU,CAAA,EAC9C,MACF,CACA,GAAGK,EAAS,SAAS,KAAK,IAAM,UAAYA,EAAS,SAAS,KAAW,IAAA,gBAAkBH,EAAS,QAAQ,GAC1FY,EAAA,CAAC,UAAYT,EAAS,SAAU,YAAcA,EAAS,WAAY,CAAA,EAAE,KAAYK,GAAA,CAC/F,GAAGA,IAAM,EAAE,CACT,MAAMK,EAAQC,IACdC,EAASF,CAAK,EACdG,EAAQb,EAAS,QAAQ,EACzBL,EAAK,CAAE,QAAS,QAAS,MAAO,SAAW,CAAA,EACtCF,EAAA,CAAE,KAAM,UAAA,CAAY,CAAA,MAEzBE,EAAK,CAAE,QAAS,UAAW,MAAO,QAAU,CAAA,CAC9C,CACD,EAAE,MAAamB,GAAA,CACXA,EAAI,SACAnB,EAAA,CAAE,QAASmB,EAAI,SAAS,KAAK,IAAK,MAAO,SAAU,EAExDnB,EAAK,CAAE,QAAS,OAAQ,MAAO,QAAU,CAAA,CAC3C,CACD,UAGAK,EAAS,SAAS,KAAK,IAAM,SAC9BA,EAAS,SAAS,KAAK,IAAM,gBAAqBA,EAAS,WAAa,UACxEA,EAAS,WAAa,eACtB,CACA,MAAMU,EAAQC,IACdC,EAASF,CAAK,EACdG,EAAQb,EAAS,QAAQ,EAEzBL,EAAK,CAAE,QAAS,QAAS,MAAO,SAAW,CAAA,EACtCF,EAAA,CAAE,KAAM,UAAA,CAAY,CAAA,MAEzBE,EAAK,CAAE,QAAS,QAAS,MAAO,OAAS,CAAA,CAC3C"}