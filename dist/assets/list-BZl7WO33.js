import{m as Z,a as ee,u as le}from"./machines-ByfLjPcQ.js";import{f as ae,c as oe}from"./date-BJiIg-Wo.js";import{u as se}from"./useToast-COV4_F9C.js";import{_ as te,r as t,U as B,B as ne,g as ue,w as n,f as u,a as re,b as V,h as s,i as y,t as w,u as F}from"./index-DSMUlJua.js";import"./request-CFRNLJUO.js";const ie={class:"mb-4"},de={class:"filters-row mt-4"},me={class:"table-responsive"},ce={class:"flex justify-end mt-4"},pe={class:"ml-4 self-center text-gray-600"},ve={__name:"list",setup(_e){const{init:f}=se(),i=t(""),d=t(""),m=t(""),c=t(""),p=t(""),v=t(""),x=t([]),I=t([]),T=t([]),_=t(!1),o=B({id:null,hostname:"",sub_user_name:"",currency:"",group:"",is_in_black_list:""}),g=t(1),k=t(100),D=t([]),z=t(!1),b=B({page:1,pagesize:10}),P=[{value:"0",text:"是"},{value:"1",text:"否"}],O=l=>l.map(e=>({value:e,text:e})),W=async()=>{try{const l=await Z(),e={value:"",text:"所有"};x.value=[e,...O(l.currencies||[])],I.value=[e,...O(l.idcs||[])],T.value=[e,...O(l.sub_users||[])]}catch(l){console.error("接口调用失败:",l)}},A=[{key:"id",label:"机器ID"},{key:"hostname",label:"机器名"},{key:"idc",label:"机房"},{key:"currency",label:"币种"},{key:"model_name",label:"机器类型"},{key:"uid",label:"用户UID"},{key:"sub_user_name",label:"子账户名"},{key:"mobile",label:"手机号"},{key:"last_seen",label:"最近提交时间"},{key:"created_time",label:"创建时间"},{key:"is_in_black_list",label:"是否参与分配"},{key:"actions",label:"操作"}],L=l=>{b.page=Math.ceil(l/b.pagesize),g.value=l,r()},r=async()=>{z.value=!0;try{const l={...b,mobile:d.value,hostname:i.value,sub_user_name:m.value,currency:c.value.value,uid:p.value,idc:v.value.value},e=await ee(l);e&&Array.isArray(e.machines)&&typeof e.total=="number"?(D.value=e.machines,k.value=e.total):e.machines===null?(D.value=[],k.value=0):f({message:"查询错误",color:"danger"})}catch(l){console.error("获取数据失败:",l),f({message:"获取数据失败",color:"danger"})}finally{z.value=!1}};ne([i,d,m,c,p,v],()=>{b.page=1,g.value=1,r()});const N=()=>{r()},j=l=>{o.id=l.rowData.id,o.hostname=l.rowData.hostname,o.sub_user_name=l.rowData.sub_user_name+" ("+l.rowData.uid+")",o.currency=l.rowData.currency,o.group=l.rowData.group,o.idc=l.rowData.idc,o.is_in_black_list=S(l.rowData.is_in_black_list),_.value=!0},S=l=>l===0||l==="0"?"是":"否",q=()=>{_.value=!1,G()},E=()=>{i.value="",d.value="",m.value="",c.value="",p.value="",v.value="",r(),W()},$=async()=>{try{let l=o.sub_user_name.value;l!=null&&(l=l.substring(0,l.indexOf(" ")));const e=await le(o.id,{hostname:o.hostname,sub_user_name:l,idc:o.idc,currency:o.currency.value,is_in_black_list:o.is_in_black_list.value,group:o.group});f({message:e,color:"success"}),await r(),_.value=!1}catch(l){console.error("更新失败:",l),f({message:"更新失败",color:"danger"})}},G=()=>{o.id=null,o.hostname="",o.sub_user_name=""};return r(),W(),(l,e)=>{const U=u("va-input"),h=u("va-select"),C=u("va-button"),H=u("va-button-group"),J=u("VaDataTable"),M=u("VaInput"),K=u("VaSelect"),Q=u("VaForm"),R=u("VaModal"),X=u("VaPagination"),Y=u("va-card");return re(),ue(Y,{class:"machines-list"},{default:n(()=>[V("div",ie,[s(U,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),placeholder:"搜索机器名",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[14]||(e[14]=[])),_:1},8,["modelValue"]),s(U,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),placeholder:"搜索手机号",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[15]||(e[15]=[])),_:1},8,["modelValue"]),s(U,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),placeholder:"搜索子账户",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[16]||(e[16]=[])),_:1},8,["modelValue"]),s(U,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),placeholder:"搜索用户UID",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[17]||(e[17]=[])),_:1},8,["modelValue"]),V("div",de,[s(h,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),options:x.value,placeholder:"币种筛选",class:"filter-item mr-5",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),s(h,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),options:I.value,placeholder:"机房筛选",class:"filter-item",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),s(C,{onClick:N,class:"ml-5",color:"rgb(47, 148, 172)"},{default:n(()=>e[18]||(e[18]=[y(" 搜索 ")])),_:1}),s(C,{onClick:E,class:"ml-5",color:"rgb(47, 148, 172)"},{default:n(()=>e[19]||(e[19]=[y(" 重置 ")])),_:1})])]),V("div",me,[s(J,{items:D.value,columns:A,striped:"",class:"responsive-table"},{"cell(created_time)":n(({value:a})=>[y(w(F(ae)(a)),1)]),"cell(last_seen)":n(({value:a})=>[y(w(F(oe)(a)),1)]),"cell(is_in_black_list)":n(({value:a})=>[y(w(S(a)),1)]),"cell(actions)":n(({row:a})=>[s(H,null,{default:n(()=>[s(C,{size:"small",icon:"edit",color:"rgb(47, 148, 172)",onClick:be=>j(a)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),s(R,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=a=>_.value=a),title:"编辑机器信息",onCancel:q,onOk:$},{default:n(()=>[s(Q,null,{default:n(()=>[s(M,{modelValue:o.hostname,"onUpdate:modelValue":e[6]||(e[6]=a=>o.hostname=a),label:"机器名",placeholder:"请输入机器名",class:"mb-2"},null,8,["modelValue"]),s(K,{modelValue:o.sub_user_name,"onUpdate:modelValue":e[7]||(e[7]=a=>o.sub_user_name=a),label:"子账户名",options:T.value,placeholder:"请选择账户","selected-top-shown":"",class:"mb-2"},null,8,["modelValue","options"]),s(h,{modelValue:o.currency,"onUpdate:modelValue":e[8]||(e[8]=a=>o.currency=a),label:"币种",options:x.value,placeholder:"请选择币种","selected-top-shown":"",class:"mb-2"},null,8,["modelValue","options"]),s(M,{modelValue:o.group,"onUpdate:modelValue":e[9]||(e[9]=a=>o.group=a),label:"分组",placeholder:"请输入分组",class:"mb-2"},null,8,["modelValue"]),s(M,{modelValue:o.idc,"onUpdate:modelValue":e[10]||(e[10]=a=>o.idc=a),label:"机房",placeholder:"请输入机房",class:"mb-2"},null,8,["modelValue"]),s(h,{modelValue:o.is_in_black_list,"onUpdate:modelValue":e[11]||(e[11]=a=>o.is_in_black_list=a),label:"是否参与分配",options:P,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),V("div",ce,[s(X,{modelValue:g.value,"onUpdate:modelValue":[e[13]||(e[13]=a=>g.value=a),L],"page-size":b.pagesize,"visible-pages":"5",total:k.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),V("span",pe," 共 "+w(k.value)+" 条记录 ",1)])]),_:1})}}},Ue=te(ve,[["__scopeId","data-v-a490e758"]]);export{Ue as default};
//# sourceMappingURL=list-BZl7WO33.js.map
