import{g as se,p as ne,a as re}from"./allocate-Dq2O8Ask.js";import{g as ue,a as B,i as de}from"./date-CMM1G54V.js";import{u as ce}from"./useToast-Dn4Vf-hj.js";import{_ as ie,r as u,U as F,B as me,g as O,w as a,X as ve,f as c,a as Y,b as d,i as s,h as l,u as pe,t as v,k as _e,I as fe,Y as j}from"./index-BZI3N4m4.js";import"./request-DxhQ-wS8.js";const ge={class:"mb-4"},ye={class:"mb-4"},be={class:"table-responsive"},ke={class:"space-y-4"},De={class:"grid grid-cols-2 gap-4"},Ve={class:"flex justify-end mt-4"},we={class:"ml-4 self-center text-gray-600"},xe={__name:"list",setup(Ce){const R=ve(),{init:k}=ce(),_=u(ue(8)),I=u("");u([{value:"hashrate",text:"算力"},{value:"time",text:"时长"}]);const h=u(""),$=u(0),D=u(!1),q=o=>new Promise(e=>setTimeout(e,o)),L=()=>{k({message:"",color:"success",duration:5e4,render:()=>j("div",["分配成功，",j("a",{href:"javascript:void(0);",style:"color: #fff; text-decoration: underline;",onClick:()=>W()},"请前往分配记录查看")])})},W=()=>{R.push({name:"allocated"})},V=F({}),w=u(1),f=u(0),g=u([]),x=u(!1),z=u(null),y=F({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:"aleo"}),T=u(!1),S=u(!1),p=u(null),X=[{key:"uid",label:"用户UID"},{key:"sub_user_name",label:"子账户名"},{key:"machines",label:"机器数"},{key:"day_profits",label:"分配收益 "},{key:"fees",label:"手续费 "}],E=o=>{z.value=o,S.value=!0},G=o=>{if(!o)return"";const e=new Date(o),r=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0");return`${r}-${i}-${C}`},M=async(o,e)=>{x.value=!0,console.log("record_date is",o.rowData.record_date);try{const r={date:B(o.rowData.record_date),currency:o.rowData.currency,group:o.rowData.group,alloc_type:e||"hashrate"},i=await ne(r);p.value=i,T.value=!0}catch(r){console.error("获取数据失败:",r),alert("获取数据失败，请重试！")}finally{x.value=!1}},H=async(o,e)=>{D.value=!0;let r=fe();if(!V.google_code){k({message:"谷歌认证码不能为空",color:"danger"});return}console.log("data is",o.rowData);try{await q(2e3);const i={date:B(o.rowData.record_date),currency:o.rowData.currency,group:o.rowData.group,alloc_type:e,user_name:r,google_code:V.google_code},C=await re(i);L(),b()}catch(i){k({message:i||"获取数据失败",color:"info"})}finally{D.value=!1}},b=async()=>{var o;x.value=!0;try{const e={date:y.date,currency:((o=I.value)==null?void 0:o.value)||"aleo"};_.value&&(e.date=G(_.value));const r=await se(e);r!=null&&r.tasks?(g.value=r.tasks,console.log(g.value),f.value=r.total):(g.value=[],f.value=0),$.value=100}catch(e){console.error("获取数据失败:",e),k({message:e.message||"获取数据失败",color:"danger"}),g.value=[],f.value=0}finally{x.value=!1}};me([_,I],()=>{y.page=1,w.value=1,b()});const J={0:"未开始",1:"已完成",2:"已失败"},K=[{key:"id",label:"ID"},{key:"record_date",label:"日期"},{key:"currency",label:"币种"},{key:"group",label:"组名"},{key:"status",label:"状态"},{key:"actions",label:"操作"}];u(!1),F({id:null,real_power:"",real_reward:"",need_allocate:""});const Q=o=>{y.page=Math.ceil(o/y.pagesize),w.value=o,b()},Z=()=>{b()};return b(),(o,e)=>{const r=c("va-date-input"),i=c("va-button"),C=c("va-progress-bar"),ee=c("va-button-group"),ae=c("VaInput"),N=c("va-modal"),m=c("va-text"),A=c("va-card-content"),U=c("va-card"),le=c("va-card-title"),P=c("VaDataTable"),te=c("va-loading"),oe=c("VaPagination");return Y(),O(U,{class:"machines-list"},{default:a(()=>[d("div",ge,[e[7]||(e[7]=s(" 选择日期： ")),l(r,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=n=>_.value=n),placeholder:"选择日期",class:"mb-1 mr-5",style:{maxWidth:"20%"},"allowed-days":n=>!pe(de)(n)},null,8,["modelValue","allowed-days"]),l(i,{onClick:Z,class:"ml-5"},{default:a(()=>e[6]||(e[6]=[s(" 刷新 ")])),_:1})]),d("div",ye,[l(C,{"model-value":$.value,indeterminate:D.value,label:h.value,color:"primary",class:"mb-2"},null,8,["model-value","indeterminate","label"])]),d("div",be,[l(P,{items:g.value,columns:K,striped:"",class:"responsive-table"},{"cell(record_date)":a(({value:n})=>[s(v(n?n.split("T")[0]:""),1)]),"cell(need_allocate)":a(({value:n})=>[s(v(n===1?"是":"否"),1)]),"cell(status)":a(({value:n})=>[s(v(J[n]),1)]),"cell(actions)":a(({row:n})=>[l(ee,null,{default:a(()=>[l(i,{small:"",color:"success",class:"mr-4",onClick:t=>M(n,"hashrate")},{default:a(()=>e[8]||(e[8]=[s("模拟分配 (算力)")])),_:2},1032,["onClick"]),l(i,{small:"",color:"primary",class:"mr-4",onClick:t=>M(n,"time")},{default:a(()=>e[9]||(e[9]=[s("模拟分配 (时长)")])),_:2},1032,["onClick"]),l(i,{disabled:n.rowData.status===1,small:"",color:"danger",class:"mr-4",onClick:t=>E(n)},{default:a(()=>e[10]||(e[10]=[s("实际分配 (算力)")])),_:2},1032,["disabled","onClick"])]),_:2},1024),l(N,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=t=>S.value=t),title:"实际分配 (算力)","ok-text":"确认","cancel-text":"取消",size:"small",class:"audit-modal",onOk:e[3]||(e[3]=t=>H(z.value,"hashrate"))},{default:a(()=>[d("div",ke,[d("div",null,[e[11]||(e[11]=d("div",{class:"mb-2",style:{"padding-top":"0.62rem"}},"谷歌认证",-1)),l(ae,{modelValue:V.google_code,"onUpdate:modelValue":e[1]||(e[1]=t=>V.google_code=t),width:"200px",placeholder:"请输入谷歌认证码"},null,8,["modelValue"])])])]),_:1},8,["modelValue"]),l(N,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=t=>T.value=t),title:"模拟分配数据"},{default:a(()=>[l(U,{class:"mb-4"},{default:a(()=>[l(A,null,{default:a(()=>[d("div",De,[d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[12]||(e[12]=[s("分配日期：")])),_:1}),l(m,null,{default:a(()=>[s(v(p.value.record_date),1)]),_:1})]),d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[13]||(e[13]=[s("总机器数：")])),_:1}),l(m,null,{default:a(()=>[s(v(p.value.total_machines),1)]),_:1})]),d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[14]||(e[14]=[s("币种：")])),_:1}),l(m,null,{default:a(()=>{var t;return[s(v(((t=n.rowData.currency)==null?void 0:t.toUpperCase())||"Unknown"),1)]}),_:2},1024)]),d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[15]||(e[15]=[s("总分配收益：")])),_:1}),l(m,null,{default:a(()=>{var t;return[s(v((t=p.value.total_alloc_profits)==null?void 0:t.toFixed(6)),1)]}),_:1})]),d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[16]||(e[16]=[s("节点收益：")])),_:1}),l(m,null,{default:a(()=>{var t;return[s(v((t=p.value.total_profits)==null?void 0:t.toFixed(6)),1)]}),_:1})]),d("div",null,[l(m,{class:"font-bold"},{default:a(()=>e[17]||(e[17]=[s("总手续费：")])),_:1}),l(m,null,{default:a(()=>{var t;return[s(v((t=p.value.total_fees)==null?void 0:t.toFixed(6)),1)]}),_:1})])])]),_:2},1024)]),_:2},1024),l(U,null,{default:a(()=>[l(le,null,{default:a(()=>e[18]||(e[18]=[s("用户分配详情")])),_:1}),l(A,null,{default:a(()=>[l(P,{items:p.value.user_alloc_detail,columns:X,striped:"",hoverable:""},{"cell(day_profits)":a(({value:t})=>[s(v(parseFloat(t).toFixed(6)),1)]),"cell(fees)":a(({value:t})=>[s(v(parseFloat(t).toFixed(6)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:2},1032,["modelValue"])]),_:1},8,["items"]),D.value?(Y(),O(te,{key:0,message:h.value},null,8,["message"])):_e("",!0)]),d("div",Ve,[l(oe,{modelValue:w.value,"onUpdate:modelValue":[e[5]||(e[5]=n=>w.value=n),Q],"page-size":y.pagesize,"visible-pages":"5",total:f.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),d("span",we," 共 "+v(f.value)+" 条记录 ",1)])]),_:1})}}},he=ie(xe,[["__scopeId","data-v-ea6f2431"]]);export{he as default};
//# sourceMappingURL=list-CgfwZx1y.js.map
