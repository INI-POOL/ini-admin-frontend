import{g as Q,a as X}from"./request-Ds9cZTqy.js";import{m as Z}from"./machines-DzcutNKA.js";import{i as ee,b as T}from"./date-Y2sbzHu6.js";import{u as ae}from"./useToast-CVRP6Xfq.js";import{_ as le,r as n,U as I,B as oe,g as te,w as s,f as u,a as se,b as w,h as t,u as P,i as d,t as m}from"./index-DEwvr2kN.js";function re(k){return Q("/api/v1/back_stage/pre_allocate/pool_profits/daily",k)}function ne(k,_){return X(`/api/v1/back_stage/pre_allocate/pool_profits/modify?id=${k}`,_)}const ue={class:"mb-4"},ce={class:"filters-row"},de={class:"table-responsive"},pe={class:"flex justify-end mt-4"},ie={class:"ml-4 self-center text-gray-600"},me={__name:"node_revenue",setup(k){const{init:_}=ae(),p=n(),v=n(""),z=n([]),O=n([]),f=n(O[0]),C=l=>l.map(e=>({value:e,text:e})),g=async()=>{try{const l=await Z(),e={value:"",text:"所有"};z.value=[e,...C(l.currencies||[])],O.value=[e,...C(l.groups||[])]}catch(l){console.error("接口调用失败:",l)}},h=n(1),b=n(0),D=n([]),U=n(!1),i=I({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),M=l=>{if(!l)return"";const e=new Date(l),c=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${c}-${r}-${x}`},y=async()=>{var l,e;U.value=!0;try{const c={page:i.page,pagesize:i.pagesize,currency:(l=v.value)==null?void 0:l.value,group:(e=f.value)==null?void 0:e.value};p.value&&(c.date=M(p.value));const r=await re(c);r!=null&&r.pool_profits?(D.value=r.pool_profits,b.value=r.total):(D.value=[],b.value=0)}catch(c){console.error("获取数据失败:",c),_({message:c.message||"获取数据失败",color:"danger"}),D.value=[],b.value=0}finally{U.value=!1}};oe([p,v,f],()=>{i.page=1,h.value=1,y(),g()});const N={0:"未知",1:"zkwork",2:"oula",3:"daxiang",4:"f2pool"},F=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"reward",label:"奖励"},{key:"real_reward",label:"实际奖励"},{key:"power",label:"算力"},{key:"real_power",label:"实际算力"},{key:"currency",label:"币种"},{key:"pool_type",label:"矿池类型"},{key:"group",label:"分组"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],V=n(!1),o=I({id:null,real_power:"",real_reward:"",need_allocate:""}),$=[{value:"1",text:"是"},{value:"0",text:"否"}],B=l=>l===1||l==="1"?"是":"否",W=l=>{o.id=l.rowData.id,o.real_power=l.rowData.real_power,o.real_reward=l.rowData.real_reward,o.need_allocate=l.rowData.need_allocate===1?"是":"否",V.value=!0},H=async()=>{var l;try{const e=await ne(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((l=o.need_allocate)==null?void 0:l.value)});_({message:e,color:"success"}),await y(),await g(),V.value=!1}catch(e){console.error("修改失败:",e),_({message:e.message||"修改失败",color:"danger"})}},R=()=>{V.value=!1,j()},j=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},q=l=>{i.page=Math.ceil(l/i.pagesize),h.value=l,y(),g()},A=()=>{p.value=null,f.value="",v.value="",y(),g()};return y(),g(),(l,e)=>{const c=u("va-date-input"),r=u("va-select"),x=u("va-button"),E=u("va-button-group"),G=u("VaDataTable"),S=u("VaInput"),Y=u("VaForm"),J=u("VaModal"),K=u("VaPagination"),L=u("va-card");return se(),te(L,{class:"machines-list"},{default:s(()=>[w("div",ue,[w("div",ce,[t(c,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":a=>!P(ee)(a)},null,8,["modelValue","allowed-days"]),t(r,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),options:z.value,placeholder:"币种筛选",class:"mr-5",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(r,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value=a),options:O.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),t(x,{onClick:A,class:"",color:"rgb(47, 148, 172)"},{default:s(()=>e[8]||(e[8]=[d(" 刷新 ")])),_:1})])]),w("div",de,[t(G,{items:D.value,columns:F,striped:"",class:"responsive-table"},{"cell(record_date)":s(({value:a})=>[d(m(a?a.split("T")[0]:""),1)]),"cell(power)":s(({value:a})=>[d(m(P(T)(a)),1)]),"cell(real_power)":s(({value:a})=>[d(m(P(T)(a)),1)]),"cell(need_allocate)":s(({value:a})=>[d(m(B(a)),1)]),"cell(pool_type)":s(({value:a})=>[d(m(N[a]||"未知"),1)]),"cell(actions)":s(({row:a})=>[t(E,null,{default:s(()=>[t(x,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:_e=>W(a)},null,8,["onClick"])]),_:2},1024)]),default:s(()=>[e[9]||(e[9]=d(" formatHashRate "))]),_:1},8,["items"]),t(J,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=a=>V.value=a),title:"修改记录",onCancel:R,onOk:H},{default:s(()=>[t(Y,null,{default:s(()=>[t(S,{modelValue:o.real_power,"onUpdate:modelValue":e[3]||(e[3]=a=>o.real_power=a),label:"实际算力",type:"number",placeholder:"请输入实际算力",class:"mb-2"},null,8,["modelValue"]),t(S,{modelValue:o.real_reward,"onUpdate:modelValue":e[4]||(e[4]=a=>o.real_reward=a),label:"实际奖励",type:"number",placeholder:"请输入实际奖励",class:"mb-2"},null,8,["modelValue"]),t(r,{modelValue:o.need_allocate,"onUpdate:modelValue":e[5]||(e[5]=a=>o.need_allocate=a),label:"是否需要分配",options:$,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),w("div",pe,[t(K,{modelValue:h.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>h.value=a),q],"page-size":i.pagesize,"visible-pages":"5",total:b.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),w("span",ie," 共 "+m(b.value)+" 条记录 ",1)])]),_:1})}}},Ve=le(me,[["__scopeId","data-v-f4863c99"]]);export{Ve as default};
//# sourceMappingURL=node_revenue-CnQlEw2E.js.map
