import{m as I}from"./machines-CxKHgJf4.js";import{b as N}from"./allocate-DDZpP4aZ.js";import{g as W,i as $,t as F}from"./date-3l_ArPo2.js";import{u as Y}from"./useToast-DY2oWFKw.js";import{_ as j,r as l,U as k,B as q,g as G,w as p,f as m,a as A,b,i as r,h as v,u as T,t as g}from"./index-LkJVCUGy.js";import"./request-CXVB8vf5.js";const E={class:"mb-4"},H={class:"table-responsive"},J={class:"flex justify-end mt-4"},K={class:"ml-4 self-center text-gray-600"},L={__name:"allocate",setup(Q){const{init:S}=Y(),c=l(W(8)),_=l(""),h=l([]);l(""),l([{value:"hashrate",text:"算力"},{value:"time",text:"时长"}]);const x=l([]),i=l(""),f=l(1),d=l(0),y=l([]),w=l(!1),n=k({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:"aleo"});l(!1),l(null);const D=t=>t.map(e=>({value:e,text:e})),z=async()=>{try{const t=await I(),e={value:"",text:"所有"};h.value=[e,...D(t.currencies||[])],x.value=[e,...D(t.groups||[])]}catch(t){console.error("接口调用失败:",t)}},O=t=>{if(!t)return"";const e=new Date(t),u=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${u}-${s}-${o}`},V=async()=>{var t,e,u;w.value=!0;try{const s={page:n.page,pagesize:n.pagesize,date:n.date,currency:(t=_.value)==null?void 0:t.value};c.value&&(s.date=O(c.value)),(e=i.value)!=null&&e.value&&(s.group=(u=i.value)==null?void 0:u.value);const o=await N(s);o!=null&&o.user_profits?(y.value=o.user_profits,d.value=o.total):(y.value=[],d.value=0)}catch(s){console.error("获取数据失败:",s),S({message:s.message||"获取数据失败",color:"danger"}),y.value=[],d.value=0}finally{w.value=!1}};q([c,_,i],()=>{n.page=1,f.value=1,V()});const U={0:"未开始",1:"已完成",2:"已失败"},B=[{key:"record_date",label:"记录日期"},{key:"uid",label:"用户Uid"},{key:"sub_user_name",label:"子账户"},{key:"machines",label:"机器数"},{key:"profit",label:"分配收益"},{key:"fee",label:"手续费"},{key:"group",label:"组名"},{key:"created_time",label:"分配时间"}];l(!1),k({id:null,real_power:"",real_reward:"",need_allocate:""});const C=t=>{n.page=Math.ceil(t/n.pagesize),f.value=t,V()};return V(),z(),(t,e)=>{const u=m("va-date-input"),s=m("va-select"),o=m("VaDataTable"),M=m("VaPagination"),P=m("va-card");return A(),G(P,{class:"machines-list"},{default:p(()=>[b("div",E,[e[4]||(e[4]=r(" 选择日期： ")),v(u,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),placeholder:"选择日期",class:"mb-1 mr-5",style:{maxWidth:"20%"},"allowed-days":a=>!T($)(a)},null,8,["modelValue","allowed-days"]),e[5]||(e[5]=r(" 分组： ")),v(s,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),options:x.value,placeholder:"组名",class:"filter-item mb-1 mr-5",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),e[6]||(e[6]=r(" 币种筛选： ")),v(s,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),options:h.value,placeholder:"币种",class:"mb-1 mr-5",style:{maxWidth:"16%"}},null,8,["modelValue","options"])]),b("div",H,[v(o,{items:y.value,columns:B,striped:"",class:"responsive-table"},{"cell(record_date)":p(({value:a})=>[r(g(a?a.split("T")[0]:""),1)]),"cell(need_allocate)":p(({value:a})=>[r(g(a===1?"是":"否"),1)]),"cell(status)":p(({value:a})=>[r(g(U[a]),1)]),"cell(created_time)":p(({value:a})=>[r(g(T(F)(a)),1)]),_:1},8,["items"])]),b("div",J,[v(M,{modelValue:f.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>f.value=a),C],"page-size":n.pagesize,"visible-pages":"5",total:d.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),b("span",K," 共 "+g(d.value)+" 条记录 ",1)])]),_:1})}}},le=j(L,[["__scopeId","data-v-737d69ee"]]);export{le as default};
//# sourceMappingURL=allocate-De9JuxLE.js.map
