import{g as Q,a as X}from"./request-B9dpD8q3.js";import{m as Z}from"./machines-BxmdfteP.js";import{i as ee,b as T}from"./date-CMM1G54V.js";import{u as ae}from"./useToast-FctfAaky.js";import{_ as le,r as n,U as I,B as oe,g as te,w as s,f as u,a as se,b as V,h as t,u as P,i as d,t as m}from"./index-B3aTDmKr.js";function re(w){return Q("/api/v1/back_stage/pre_allocate/pool_profits/daily",w)}function ne(w,_){return X(`/api/v1/back_stage/pre_allocate/pool_profits/modify?id=${w}`,_)}const ue={class:"mb-4"},ce={class:"filters-row"},de={class:"table-responsive"},ie={class:"flex justify-end mt-4"},pe={class:"ml-4 self-center text-gray-600"},me={__name:"node_revenue",setup(w){const{init:_}=ae(),i=n(),k=n("aleo"),z=n([]),O=n([]),v=n(O[0]),C=l=>l.map(e=>({value:e,text:e})),f=async()=>{try{const l=await Z();z.value=C(l.currencies||[]);const e={value:"",text:"所有"};O.value=[e,...C(l.groups||[])]}catch(l){console.error("接口调用失败:",l)}},D=n(1),g=n(0),h=n([]),U=n(!1),p=I({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:"aleo"}),M=l=>{if(!l)return"";const e=new Date(l),c=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${c}-${r}-${x}`},b=async()=>{var l,e;U.value=!0;try{const c={page:p.page,pagesize:p.pagesize,currency:((l=k.value)==null?void 0:l.value)||"aleo",group:(e=v.value)==null?void 0:e.value};i.value&&(c.date=M(i.value));const r=await re(c);r!=null&&r.pool_profits?(h.value=r.pool_profits,g.value=r.total):(h.value=[],g.value=0)}catch(c){console.error("获取数据失败:",c),_({message:c.message||"获取数据失败",color:"danger"}),h.value=[],g.value=0}finally{U.value=!1}};oe([i,k,v],()=>{p.page=1,D.value=1,b(),f()});const N={0:"未知",1:"zkwork",2:"oula",3:"daxiang"},F=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"reward",label:"奖励"},{key:"real_reward",label:"实际奖励"},{key:"power",label:"算力"},{key:"real_power",label:"实际算力"},{key:"currency",label:"币种"},{key:"pool_type",label:"矿池类型"},{key:"group",label:"分组"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],y=n(!1),o=I({id:null,real_power:"",real_reward:"",need_allocate:""}),$=[{value:"1",text:"是"},{value:"0",text:"否"}],B=l=>l===1||l==="1"?"是":"否",W=l=>{o.id=l.rowData.id,o.real_power=l.rowData.real_power,o.real_reward=l.rowData.real_reward,o.need_allocate=l.rowData.need_allocate===1?"是":"否",y.value=!0},H=async()=>{var l;try{const e=await ne(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((l=o.need_allocate)==null?void 0:l.value)});_({message:e,color:"success"}),await b(),await f(),y.value=!1}catch(e){console.error("修改失败:",e),_({message:e.message||"修改失败",color:"danger"})}},R=()=>{y.value=!1,j()},j=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},q=l=>{p.page=Math.ceil(l/p.pagesize),D.value=l,b(),f()},A=()=>{i.value=null,v.value="",b(),f()};return b(),f(),(l,e)=>{const c=u("va-date-input"),r=u("va-select"),x=u("va-button"),E=u("va-button-group"),G=u("VaDataTable"),S=u("VaInput"),Y=u("VaForm"),J=u("VaModal"),K=u("VaPagination"),L=u("va-card");return se(),te(L,{class:"machines-list"},{default:s(()=>[V("div",ue,[V("div",ce,[t(c,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"18%"},"allowed-days":a=>!P(ee)(a)},null,8,["modelValue","allowed-days"]),t(r,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),options:z.value,placeholder:"币种筛选",class:"mr-5",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),e[9]||(e[9]=d(" 分组： ")),t(r,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),options:O.value,placeholder:"组名",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),t(x,{onClick:A,class:"ml-5",color:"rgb(47, 148, 172)"},{default:s(()=>e[8]||(e[8]=[d(" 刷新 ")])),_:1})])]),V("div",de,[t(G,{items:h.value,columns:F,striped:"",class:"responsive-table"},{"cell(record_date)":s(({value:a})=>[d(m(a?a.split("T")[0]:""),1)]),"cell(power)":s(({value:a})=>[d(m(P(T)(a)),1)]),"cell(real_power)":s(({value:a})=>[d(m(P(T)(a)),1)]),"cell(need_allocate)":s(({value:a})=>[d(m(B(a)),1)]),"cell(pool_type)":s(({value:a})=>[d(m(N[a]||"未知"),1)]),"cell(actions)":s(({row:a})=>[t(E,null,{default:s(()=>[t(x,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:_e=>W(a)},null,8,["onClick"])]),_:2},1024)]),default:s(()=>[e[10]||(e[10]=d(" formatHashRate "))]),_:1},8,["items"]),t(J,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),title:"修改记录",onCancel:R,onOk:H},{default:s(()=>[t(Y,null,{default:s(()=>[t(S,{modelValue:o.real_power,"onUpdate:modelValue":e[3]||(e[3]=a=>o.real_power=a),label:"实际算力",type:"number",placeholder:"请输入实际算力",class:"mb-2"},null,8,["modelValue"]),t(S,{modelValue:o.real_reward,"onUpdate:modelValue":e[4]||(e[4]=a=>o.real_reward=a),label:"实际奖励",type:"number",placeholder:"请输入实际奖励",class:"mb-2"},null,8,["modelValue"]),t(r,{modelValue:o.need_allocate,"onUpdate:modelValue":e[5]||(e[5]=a=>o.need_allocate=a),label:"是否需要分配",options:$,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),V("div",ie,[t(K,{modelValue:D.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>D.value=a),q],"page-size":p.pagesize,"visible-pages":"5",total:g.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),V("span",pe," 共 "+m(g.value)+" 条记录 ",1)])]),_:1})}}},Ve=le(me,[["__scopeId","data-v-0f8e07e0"]]);export{Ve as default};
//# sourceMappingURL=node_revenue-nmP_KI0y.js.map
