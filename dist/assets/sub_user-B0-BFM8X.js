import{_ as D,r as s,U as R,B as Z,g as C,w as r,f as n,a as h,b as c,h as i,i as T,t as x,u as w,Z as A,c as G,F as H}from"./index-Bi09-Pwr.js";import{m as J}from"./machines-DyeJBO3G.js";import{g as L,a as Q}from"./request-Q-IbeB_i.js";import{t as X}from"./date-BwSFrXps.js";import{u as Y}from"./useToast-BhaMxvRu.js";function ee(v){return L("/api/v1/back_stage/sub_user/list",v)}function ae(v,k){return Q(`/api/v1/back_stage/sub_user/modify/${v}`,k)}const te={class:"mb-4"},se={class:"table-responsive"},le={class:"editable-rate"},ne={class:"flex justify-end mt-4"},oe={class:"ml-4 self-center text-gray-600"},ue={__name:"sub_user",setup(v){const{init:k}=Y(),p=s({}),d=s({}),M=a=>{p.value={...p.value,[a.sub_user_name]:!0},d.value={...d.value,[a.sub_user_name]:Math.round(a.real_rate*100)}},U=async a=>{try{const e=d.value[a.sub_user_name];if(e<0||e>100)throw new Error("费率必须在0-100%之间");await ae(a.sub_user_name,{fee:e/100}),a.real_rate=e/100,p.value={...p.value,[a.sub_user_name]:!1}}catch{}},b=s("aleo"),B=s([]),o=s(""),y=s([]),u=s(""),f=s(1),_=s(0),I=s(!1),m=R({page:1,pagesize:15,currency:"aleo"});s(!1),s(null);const O=a=>a.map(e=>({value:e,text:e})),z=async()=>{try{const a=await J(),e={value:"",text:"所有"};B.value=[e,...O(a.currencies||[])]}catch(a){console.error("接口调用失败:",a)}},g=async()=>{var a;I.value=!0;try{const e={page:m.page,pagesize:m.pagesize,currency:((a=b.value)==null?void 0:a.value)||"aleo",sub_user_name:o==null?void 0:o.value,uid:u==null?void 0:u.value},l=await ee(e);l!=null&&l.sub_users?(y.value=l.sub_users,_.value=l.total):(y.value=[],_.value=0)}catch(e){console.error("获取数据失败:",e),k({message:e.message||"获取数据失败",color:"danger"}),y.value=[],_.value=0}finally{I.value=!1}};Z([b,o,u],()=>{m.page=1,f.value=1,g()});const F=[{key:"uid",label:"用户Uid"},{key:"sub_user_name",label:"子账户"},{key:"currency",label:"币种"},{key:"machines",label:"机器数"},{key:"real_rate",label:"费率(%)"},{key:"total_profit",label:"净收益"},{key:"total_fee",label:"手续费"},{key:"created_time",label:"创建时间"}],P=a=>{m.page=Math.ceil(a/m.pagesize),f.value=a,g()},$=()=>{o.value="",u.value="",g(),z()};return g(),z(),(a,e)=>{const l=n("va-input"),E=n("va-select"),K=n("va-button"),N=n("VaInput"),S=n("VaButton"),W=n("VaDataTable"),j=n("VaPagination"),q=n("va-card");return h(),C(q,{class:"machines-list"},{default:r(()=>[c("div",te,[i(l,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),label:"用户UID",placeholder:"搜索用户UID",class:"mb-1 mr-8",style:{maxWidth:"13%"}},{prepend:r(()=>e[4]||(e[4]=[])),_:1},8,["modelValue"]),i(l,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value=t),label:"子账户",placeholder:"搜索子账户",class:"mb-1 mr-8",style:{maxWidth:"13%"}},{prepend:r(()=>e[5]||(e[5]=[])),_:1},8,["modelValue"]),i(E,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),label:"币种",options:B.value,placeholder:"请选择币种","selected-top-shown":"",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),i(K,{onClick:$,class:"mt-5 mr-8",color:"rgb(47, 148, 172)"},{default:r(()=>e[6]||(e[6]=[T(" 刷新 ")])),_:1})]),c("div",se,[i(W,{items:y.value,columns:F,striped:"",class:"responsive-table"},{"cell(created_time)":r(({value:t})=>[T(x(w(X)(t)),1)]),"cell(real_rate)":r(({rowData:t,rowIndex:re})=>[c("div",le,[p.value[t.sub_user_name]?(h(),C(N,{key:0,modelValue:d.value[t.sub_user_name],"onUpdate:modelValue":V=>d.value[t.sub_user_name]=V,modelModifiers:{number:!0},type:"number",step:"1",min:"0",max:"100",onKeyup:A(V=>U(t),["enter"]),onBlur:V=>U(t)},{appendInner:r(()=>e[7]||(e[7]=[c("span",{class:"percent-symbol"},"%",-1)])),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(h(),G(H,{key:1},[c("span",null,x(Math.round(t.real_rate*100))+"%",1),i(S,{preset:"plain",icon:"edit",color:"rgb(47, 148, 172)",class:"ml-2",onClick:V=>M(t)},null,8,["onClick"])],64))])]),_:1},8,["items"])]),c("div",ne,[i(j,{modelValue:f.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>f.value=t),P],"page-size":m.pagesize,"visible-pages":"5",total:_.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),c("span",oe," 共 "+x(_.value)+" 条记录 ",1)])]),_:1})}}},_e=D(ue,[["__scopeId","data-v-a2ba6f88"]]);export{_e as default};
//# sourceMappingURL=sub_user-B0-BFM8X.js.map
