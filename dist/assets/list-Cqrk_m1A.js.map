{"version":3,"file":"list-Cqrk_m1A.js","sources":["../../src/api/machines.js","../../src/pages/machines/list.vue"],"sourcesContent":["import { post } from \"./request\";\n\n\n// 查询机器列表\nexport function machinList(data) {\n  return post(\"/api/v1/back_stage/machine/list\", data);\n}\n\n// 更新机器信息\nexport function updateMachine(id,data) { \n  return post(`/api/v1/back_stage/machine/modify?id=${id}`,data);  \n}\n","<template>\n    <va-card class=\"machines-list\">\n        <!-- 搜索和过滤区域 -->\n        <div class=\"mb-4\">\n            <va-input v-model=\"searchQuery\" placeholder=\"搜索矿机...\" class=\"mb-2\" :style=\"{ maxWidth: '100%' }\">\n                <template #prepend>\n                    <va-icon name=\"search\" />\n                </template>\n            </va-input>\n\n            <div class=\"filters-row\">\n                <va-select v-model=\"statusFilter\" :options=\"statusOptions\" placeholder=\"状态筛选\" class=\"filter-item\" />\n                <va-button @click=\"refreshList\" class=\"ml-2\">\n                    <va-icon name=\"refresh\" />\n                    刷新\n                </va-button>\n            </div>\n        </div>\n\n        <!-- 列表区域 -->\n        <div class=\"table-responsive\">\n            <!-- 桌面端显示表格 -->\n            <VaDataTable :items=\"machines\" :columns=\"columns\" striped  class=\"responsive-table\">\n                <!-- 时间显示 -->\n                <template #cell(created_time)=\"{ value }\">\n                    {{ formatDateTime(value) }}\n                </template>\n\n                <template #cell(actions)=\"{ row }\">\n                    <va-button-group>\n                        <va-button small icon=\"edit\" color=\"primary\" @click=\"editMachine(row)\" />\n                        <va-button small icon=\"delete\" color=\"danger\" @click=\"deleteMachine(row)\" />\n                    </va-button-group>\n                </template>\n            </VaDataTable>\n\n            <!-- 移动端显示卡片列表 -->\n            <!-- <div class=\"mobile-list hidden-md-and-up\">\n                <va-card v-for=\"machine in filteredMachines\" :key=\"machine.id\" class=\"mb-3\">\n                    <div class=\"mobile-list-item\">\n                        <div class=\"mb-2\">\n                            <strong>ID:</strong> {{ machine.id }}\n                        </div>\n                        <div class=\"mb-2\">\n                            <strong>名称:</strong> {{ machine.name }}\n                        </div>\n                        <div class=\"mb-2\">\n                            <strong>状态:</strong>\n                            <va-badge :color=\"getStatusColor(machine.status)\">\n                                {{ machine.status }}\n                            </va-badge>\n                        </div>\n                        <div class=\"mobile-actions\">\n                            <va-button-group>\n                                <va-button small icon=\"edit\" color=\"primary\" @click=\"editMachine(machine)\" />\n                                <va-button small icon=\"delete\" color=\"danger\" @click=\"deleteMachine(machine)\" />\n                            </va-button-group>\n                        </div>\n                    </div>\n                </va-card>\n            </div> -->\n        </div>\n\n        <!-- 分页 -->\n        <!-- <va-pagination v-model=\"currentPage\" :total=\"totalItems\" :per-page=\"perPage\" class=\"mt-4\" /> -->\n        <div class=\"flex justify-end mt-4\">\n          <VaPagination\n            v-model=\"currentStartIndex\"\n            :page-size=\"queryParams.pagesize\"\n            visible-pages=\"5\"\n            :total=\"totalItems\"\n            buttons-preset=\"secondary\"\n            boundary-numbers\n            @update:modelValue=\"handlePageChange\"\n          />\n          <span class=\"ml-4 self-center text-gray-600\">\n            共 {{ totalItems }} 条记录\n          </span>\n        </div>\n    </va-card>\n\n\n      <!-- 转账详情弹框 -->\n      <VaModal v-model=\"detailVisible\" title=\"转账详情\" size=\"medium\"  class=\"mr-6 my-1\"  close-button >\n      <template #content>\n        <!-- 头部信息 -->\n        <div class=\"transfer-header\" style=\"display: flex; align-items: center; justify-content: center;flex-direction: column;gap: 0.62rem; padding-top: 1rem;\">\n          <div class=\"time\">{{ formatDateTime(transfer.created_time) }}</div>\n        </div>\n        <VaDivider />\n\n        <!-- 主要信息 -->\n        <div class=\"transfer-info\">\n          <div class=\"info-row\">\n            <span class=\"label\">数额：</span>\n            <div class=\"value-box\">\n            <span class=\"value\">{{removeTrailingZeros(transfer?.amount) || 0 }} {{ transfer.currency }}</span>\n          </div>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">提款手续费：</span>\n            <div class=\"value-box\">\n            <span class=\"value\">{{removeTrailingZeros(transfer?.gas_fee) || 0   }} {{ transfer.currency }}</span>\n          </div>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">收款地址：</span>\n            <div class=\"value-box\">\n            <span class=\"value\"  @click=\"copyText(transfer.to_addr)\">{{ transfer.to_addr }}</span>\n            <VaIcon class=\"material-icons\" @click=\"copyText(transfer.to_addr)\">\n              content_copy\n          </VaIcon>\n          </div>\n          </div>\n          <div class=\"info-row\">\n            <span class=\"label\">付款地址：</span>\n            <div class=\"value-box\">\n            <span class=\"value\"  @click=\"copyText(transfer.from_addr)\">{{ transfer.from_addr }}</span>\n            <VaIcon v-if=\"transfer.from_addr\" class=\"material-icons\" @click=\"copyText(transfer.from_addr)\">\n              content_copy\n          </VaIcon>\n          </div>\n          </div>\n        </div>\n        <VaDivider />\n\n        <!-- 交易号 -->\n        <div class=\"transaction-id\">\n          <span class=\"label\">交易号：</span>\n          <div class=\"value-box\">\n          <span class=\"value\"><a  :href=\"`https://mainnet.aleo123.io/transactionDetail/${transfer.tx_id}`\" target=\"_blank\">{{ transfer.tx_id }}</a> </span>\n          <VaIcon  v-if=\"transfer.tx_id\" class=\"material-icons\" @click=\"copyText(transfer.tx_id)\">\n              content_copy\n          </VaIcon>\n        </div></div>\n      </template>\n    </VaModal>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\nimport { machinList, updateMachine } from \"../../api/machines\"\nimport { formatDateTime } from \"../../utils/date.ts\";\nimport { useToast } from \"vuestic-ui\";\n\nconst { init: toast } = useToast()\n\n// 响应式状态\nconst searchQuery = ref('')\nconst statusFilter = ref(null)\nconst currentStartIndex = ref(1);\nconst totalItems = ref(100)\nconst machines = ref([])\nconst loading = ref(false)\n// 查询参数\nconst queryParams = reactive({\n  page: 1,\n  pagesize: 10,\n})\n\n// 常量数据\nconst statusOptions = [\n    { value: 'active', text: '运行中' },\n    { value: 'inactive', text: '已停止' },\n    { value: 'error', text: '错误' }\n]\n\nconst columns = [\n\n    { key: 'id', label: '机器ID' },\n    { key: 'hostname', label: '机器名' },\n    { key: 'idc', label: '机房' },\n    { key: 'hostname', label: '名称' },\n    { key: 'currency', label: '币种' },\n    { key: 'model_name', label: '机器类型' },\n    { key:'sub_user_name', label: '子账户名' },\n    { key:'uid', label: '用户UID' },\n    { key: 'mobile', label: '手机号' },\n    {key: 'last_seen', label: '上次提交时间' },\n    {key: 'created_time', label: '创建时间' },\n    // { key: 'status', label: '状态' },\n    { key: 'actions', label: '操作' }\n]\n\n// 计算属性\n// const filteredMachines = computed(() => {\n//     return machines.value.filter(machine => {\n//         const matchesSearch = machine.name.toLowerCase().includes(searchQuery.value.toLowerCase())\n//         const matchesStatus = !statusFilter.value || machine.status === statusFilter.value\n//         return matchesSearch && matchesStatus\n//     })\n// })\n\n// 分页\nconst handlePageChange = (startIndex) => {\n    queryParams.page = Math.ceil(startIndex / queryParams.pagesize);\n    currentStartIndex.value = startIndex;\n    fetchData();\n};\n\n// 方法\nconst fetchData = async () => {\n    loading.value = true\n    try {\n        const res = await machinList(queryParams)\n\n        if (res && typeof res.total === \"number\") {\n            machines.value = res.machines || []\n            totalItems.value = res.total\n        } else {\n            console.error(\"API返回数据格式错误:\", res)\n            toast({\n                message: \"数据格式错误\",\n                color: \"danger\",\n            })\n        }\n    } catch (error) {\n        console.error(\"获取数据失败:\", error)\n        toast({\n            message: \"获取数据失败\",\n            color: \"danger\",\n        })\n    } finally {\n        loading.value = false\n    }\n}\n\nconst getStatusColor = (status) => {\n    const colors = {\n        active: 'success',\n        inactive: 'warning',\n        error: 'danger'\n    }\n    return colors[status] || 'gray'\n}\n\nconst refreshList = () => {\n    fetchData()\n}\n\nconst editMachine = async (machine) => {\n    try {\n        await updateMachine(machine.id, machine)\n        toast({\n            message: \"更新成功\",\n            color: \"success\",\n        })\n        await fetchData()\n    } catch (error) {\n        console.error(\"更新失败:\", error)\n        toast({\n            message: \"更新失败\",\n            color: \"danger\",\n        })\n    }\n}\n\nconst deleteMachine = async (machine) => {\n    // 实现删除逻辑\n}\n\n// 初始化加载数据\nfetchData()\n</script>\n\n<style scoped>\n.machines-list {\n    padding: 20px;\n}\n\n.filters-row {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 10px;\n    align-items: center;\n}\n\n.filter-item {\n    min-width: 150px;\n}\n\n.mobile-list-item {\n    padding: 10px;\n}\n\n.mobile-actions {\n    display: flex;\n    justify-content: flex-end;\n    margin-top: 10px;\n}\n\n.action-buttons {\n    display: flex;\n    gap: 0.5rem;\n    justify-content: center;\n    padding-left: 5px;\n    padding-right: 5px;\n    min-width: 40px; /* 确保按钮有足够空间 */\n  }\n\n@media (max-width: 768px) {\n    .machines-list {\n        padding: 10px;\n    }\n\n    .filter-item {\n        width: 100%;\n        min-width: unset;\n    }\n}\n</style>"],"names":["machinList","data","post","updateMachine","id","toast","useToast","searchQuery","ref","statusFilter","currentStartIndex","totalItems","machines","loading","queryParams","reactive","statusOptions","columns","handlePageChange","startIndex","fetchData","res","error","refreshList","editMachine","machine","deleteMachine"],"mappings":"sQAIO,SAASA,EAAWC,EAAM,CAC/B,OAAOC,EAAK,kCAAmCD,CAAI,CACrD,CAGO,SAASE,EAAcC,EAAGH,EAAM,CACrC,OAAOC,EAAK,wCAAwCE,CAAE,GAAGH,CAAI,CAC/D,orBCsIA,KAAM,CAAE,KAAMI,CAAO,EAAGC,EAAU,EAG5BC,EAAcC,EAAI,EAAE,EACpBC,EAAeD,EAAI,IAAI,EACvBE,EAAoBF,EAAI,CAAC,EACzBG,EAAaH,EAAI,GAAG,EACpBI,EAAWJ,EAAI,EAAE,EACjBK,EAAUL,EAAI,EAAK,EAEnBM,EAAcC,EAAS,CAC3B,KAAM,EACN,SAAU,EACZ,CAAC,EAGKC,EAAgB,CAClB,CAAE,MAAO,SAAU,KAAM,KAAO,EAChC,CAAE,MAAO,WAAY,KAAM,KAAO,EAClC,CAAE,MAAO,QAAS,KAAM,IAAM,CAClC,EAEMC,EAAU,CAEZ,CAAE,IAAK,KAAM,MAAO,MAAQ,EAC5B,CAAE,IAAK,WAAY,MAAO,KAAO,EACjC,CAAE,IAAK,MAAO,MAAO,IAAM,EAC3B,CAAE,IAAK,WAAY,MAAO,IAAM,EAChC,CAAE,IAAK,WAAY,MAAO,IAAM,EAChC,CAAE,IAAK,aAAc,MAAO,MAAQ,EACpC,CAAE,IAAI,gBAAiB,MAAO,MAAQ,EACtC,CAAE,IAAI,MAAO,MAAO,OAAS,EAC7B,CAAE,IAAK,SAAU,MAAO,KAAO,EAC/B,CAAC,IAAK,YAAa,MAAO,QAAU,EACpC,CAAC,IAAK,eAAgB,MAAO,MAAQ,EAErC,CAAE,IAAK,UAAW,MAAO,IAAM,CACnC,EAYMC,EAAoBC,GAAe,CACrCL,EAAY,KAAO,KAAK,KAAKK,EAAaL,EAAY,QAAQ,EAC9DJ,EAAkB,MAAQS,EAC1BC,GACJ,EAGMA,EAAY,SAAY,CAC1BP,EAAQ,MAAQ,GAChB,GAAI,CACA,MAAMQ,EAAM,MAAMrB,EAAWc,CAAW,EAEpCO,GAAO,OAAOA,EAAI,OAAU,UAC5BT,EAAS,MAAQS,EAAI,UAAY,CAAE,EACnCV,EAAW,MAAQU,EAAI,QAEvB,QAAQ,MAAM,eAAgBA,CAAG,EACjChB,EAAM,CACF,QAAS,SACT,MAAO,QACvB,CAAa,EAER,OAAQiB,EAAO,CACZ,QAAQ,MAAM,UAAWA,CAAK,EAC9BjB,EAAM,CACF,QAAS,SACT,MAAO,QACnB,CAAS,CACT,QAAc,CACNQ,EAAQ,MAAQ,EACnB,CACL,EAWMU,EAAc,IAAM,CACtBH,EAAW,CACf,EAEMI,EAAc,MAAOC,GAAY,CACnC,GAAI,CACA,MAAMtB,EAAcsB,EAAQ,GAAIA,CAAO,EACvCpB,EAAM,CACF,QAAS,OACT,MAAO,SACnB,CAAS,EACD,MAAMe,EAAW,CACpB,OAAQE,EAAO,CACZ,QAAQ,MAAM,QAASA,CAAK,EAC5BjB,EAAM,CACF,QAAS,OACT,MAAO,QACnB,CAAS,CACJ,CACL,EAEMqB,EAAgB,MAAOD,GAAY,CAEzC,EAGA,OAAAL,EAAW"}