import{g as ie,p as de,a as E}from"./request-B9dpD8q3.js";import{a as ue}from"./date-CMM1G54V.js";import{u as ce}from"./useToast-FctfAaky.js";import{_ as me,r as u,e as ve,U as z,g as O,w as n,f as d,a as m,b as s,h as t,i as v,t as h,u as pe,c as f,F as $,k as _e}from"./index-B3aTDmKr.js";function fe(c){return ie("/api/v1/back_stage/version/list",c)}function ge(c){return de("/api/v1/back_stage/version/add",c)}function Ve(c,i){return E(`/api/v1/back_stage/version/modify?version=${c}`,i).then(p=>{if(!p)throw new Error("ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÊú™ËøîÂõûÂìçÂ∫îÊï∞ÊçÆ");return p})}function be(c){return E(`/api/v1/back_stage/version/publish?version=${c}`).then(i=>{if(!i)throw new Error("ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÊú™ËøîÂõûÂìçÂ∫îÊï∞ÊçÆ");return i})}const ye={class:"mb-4"},ke={class:"filters-row"},we={class:"table-responsive"},he=["title","href"],xe={class:"status-indicator"},Ce={key:0,class:"published"},Ue={key:1,class:"unpublished"},De=["title"],ze={class:"dialog-header"},Pe={class:"dialog-content"},Ae={class:"version-info"},Te={class:"version-highlight"},Be={class:"flex justify-end mt-4"},Me={class:"ml-4 self-center text-gray-600"},Fe={__name:"version",setup(c){const{init:i}=ce();u([{value:"aleo",text:"Aleo"}]);const p=u(1),g=u(0),x=u([]),P=u(!1),V=u(!1),C=u(null),I=a=>(C.value=a,V.value=!0,new Promise(e=>{resolvePromise.value=e})),q=async()=>{try{await J(C.value),resolvePromise.value(!0)}catch{resolvePromise.value(!1)}finally{V.value=!1}},R=()=>{i({message:"Â∑≤ÂèñÊ∂àÂèëÂ∏É",color:"warning"}),resolvePromise.value(!1),V.value=!1},A=a=>/^v\d+\.\d+\.\d+(-[a-zA-Z0-9]+)?$/.test(a)||"Ê†ºÂºèÁ§∫‰æãÔºöv1.0.0 Êàñ v2.3.4-beta",T=a=>{try{return new URL(a),!0}catch{return"ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑURLÂú∞ÂùÄ"}},B=ve(()=>A(o==null?void 0:o.version)===!0&&T(o==null?void 0:o.download_url)===!0),b=z({page:1,pagesize:15}),y=u(!1),o=z({version:"",download_url:"",release_notes:""}),S=()=>{y.value=!0},j=(a,e)=>a?a.length>e?a.slice(0,e)+"...":a:"",k=async()=>{P.value=!0;try{const a={page:b.page,pagesize:b.pagesize},e=await fe(a);e!=null&&e.versions?(x.value=e.versions,g.value=e.total):(x.value=[],g.value=0)}catch(a){console.error("Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:",a),i({message:a.message||"Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•",color:"danger"}),x.value=[],g.value=0}finally{P.value=!1}},Z=[{key:"version",label:"ÁâàÊú¨Âè∑"},{key:"release_date",label:"ÂèëÂ∏ÉÊó•Êúü"},{key:"download_url",label:"‰∏ãËΩΩÈìæÊé•"},{key:"release_notes",label:"Êõ¥Êñ∞Êó•Âøó"},{key:"is_latest",label:"ÂèëÂ∏ÉÁä∂ÊÄÅ"},{key:"actions",label:"Êìç‰Ωú"}],w=u(!1),r=z({version:"",release_notes:"",download_url:""}),G=a=>{r.version=a.rowData.version,r.download_url=a.rowData.download_url,r.release_notes=a.rowData.release_notes,w.value=!0},H=async()=>{try{const a=await Ve(r.version,{download_url:r.download_url,release_notes:r.release_notes});i({message:a,color:"success"}),await k(),w.value=!1}catch(a){console.error("‰øÆÊîπÂ§±Ë¥•:",a),i({message:a.message||"‰øÆÊîπÂ§±Ë¥•",color:"danger"})}},J=async a=>{try{const e=await be(a);i({message:e,color:"success",duration:3e3}),await k()}catch(e){i({message:e.message||"ÂèëÂ∏ÉÂ§±Ë¥•",color:"danger",duration:5e3})}},K=async()=>{if(B.value)try{const a=await ge({version:o.version,download_url:o.download_url,release_notes:o.release_notes});i({message:a,color:"success"}),await k(),y.value=!1}catch(a){console.error("‰øÆÊîπÂ§±Ë¥•:",a),i({message:a.message||"‰øÆÊîπÂ§±Ë¥•",color:"danger"})}},Q=()=>{w.value=!1,X()},W=()=>{y.value=!1,Y()},X=()=>{r.version="",r.download_url="",r.release_notes=""},Y=()=>{o.version="",o.download_url="",o.release_notes=""},ee=a=>{b.page=Math.ceil(a/b.pagesize),p.value=a,k()};return k(),(a,e)=>{const U=d("va-button"),_=d("VaInput"),M=d("VaForm"),D=d("VaModal"),le=d("va-button-group"),ae=d("VaDataTable"),se=d("va-icon"),oe=d("va-divider"),te=d("VaPagination"),ne=d("va-card");return m(),O(ne,{class:"machines-list"},{default:n(()=>[s("div",ye,[s("div",ke,[t(U,{onClick:S,color:"rgb(47, 148, 172)",class:"ml-5"},{default:n(()=>e[10]||(e[10]=[v(" Êñ∞Â¢ûÁâàÊú¨ ")])),_:1}),t(D,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),title:"Êñ∞Â¢ûÁâàÊú¨",onCancel:W,onOk:K,"ok-disabled":!B.value},{default:n(()=>[t(M,null,{default:n(()=>[t(_,{modelValue:o.version,"onUpdate:modelValue":e[0]||(e[0]=l=>o.version=l),label:"ÁâàÊú¨Âè∑",rules:[A],required:"",type:"string",class:"mb-2",placeholder:"v1.0.0"},null,8,["modelValue","rules"]),t(_,{modelValue:o.download_url,"onUpdate:modelValue":e[1]||(e[1]=l=>o.download_url=l),label:"‰∏ãËΩΩÈìæÊé•",type:"url",rules:[T],required:"",class:"mb-2",placeholder:"https://apps.apple.com/app/..."},null,8,["modelValue","rules"]),t(_,{modelValue:o.release_notes,"onUpdate:modelValue":e[2]||(e[2]=l=>o.release_notes=l),label:"Êõ¥Êñ∞Êó•Âøó (Â¶ÇÈúÄÊç¢Ë°åËØ∑Áî®','ÈöîÂºÄ)",type:"textarea",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue","ok-disabled"])])]),s("div",we,[t(ae,{items:x.value,columns:Z,striped:"",class:"responsive-table"},{"cell(release_date)":n(({value:l})=>[v(h(pe(ue)(l)),1)]),"cell(download_url)":n(({value:l})=>[l?(m(),f("a",{key:1,title:l,href:l,target:"_blank"},h(l),9,he)):(m(),f($,{key:0},[v("Êó†")],64))]),"cell(is_latest)":n(({value:l})=>[s("div",xe,[l==="1"||l===1?(m(),f("span",Ce,e[11]||(e[11]=[s("svg",{width:"20",height:"20",viewBox:"0 0 16 16"},[s("circle",{cx:"8",cy:"8",r:"7",fill:"#67C23A"}),s("path",{d:"M6.5 10.793L4.354 8.646a.5.5 0 0 0-.708.708l2.5 2.5a.5.5 0 0 0 .708 0l5-5a.5.5 0 1 0-.708-.708L6.5 10.793z",fill:"#fff"})],-1)]))):(m(),f("span",Ue,e[12]||(e[12]=[s("svg",{width:"20",height:"20",viewBox:"0 0 16 16"},[s("circle",{cx:"8",cy:"8",r:"7",fill:"#909399"}),s("g",{transform:"translate(4.5, 5.5)"},[s("circle",{cx:"1",cy:"1",r:"1",fill:"#fff"}),s("circle",{cx:"4",cy:"1",r:"1",fill:"#fff"}),s("circle",{cx:"7",cy:"1",r:"1",fill:"#fff"})])],-1)])))])]),"cell(release_notes)":n(({value:l})=>[l?(m(),f("span",{key:1,title:l},h(j(l,20)),9,De)):(m(),f($,{key:0},[v("Êó†")],64))]),"cell(actions)":n(({row:l})=>[t(le,null,{default:n(()=>{var F,L;return[t(U,{color:"rgb(47, 148, 172)",size:"small",class:"mr-4",icon:"edit",onClick:re=>G(l)},{default:n(()=>e[13]||(e[13]=[v("‰øÆÊîπ")])),_:2},1032,["onClick"]),((F=l==null?void 0:l.rowData)==null?void 0:F.is_latest)==="0"||((L=l==null?void 0:l.rowData)==null?void 0:L.is_latest)===0?(m(),O(U,{key:0,title:"ÁÇπÂáªÂèëÂ∏ÉËØ•ÁâàÊú¨",size:"small",color:"rgb(47, 148, 172)",icon:"rocket",onClick:re=>{var N;return I((N=l==null?void 0:l.rowData)==null?void 0:N.version)}},{default:n(()=>e[14]||(e[14]=[v("ÂèëÂ∏É")])),_:2},1032,["onClick"])):_e("",!0)]}),_:2},1024)]),_:1},8,["items"]),t(D,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=l=>w.value=l),title:"‰øÆÊîπÁâàÊú¨‰ø°ÊÅØ",onCancel:Q,onOk:H},{default:n(()=>[t(M,null,{default:n(()=>[t(_,{modelValue:r.version,"onUpdate:modelValue":e[4]||(e[4]=l=>r.version=l),label:"ÁâàÊú¨Âè∑",type:"string",class:"mb-3",readonly:""},null,8,["modelValue"]),t(_,{modelValue:r.download_url,"onUpdate:modelValue":e[5]||(e[5]=l=>r.download_url=l),label:"‰∏ãËΩΩÈìæÊé•",type:"string",class:"mb-3"},null,8,["modelValue"]),t(_,{modelValue:r.release_notes,"onUpdate:modelValue":e[6]||(e[6]=l=>r.release_notes=l),label:"Êõ¥Êñ∞Êó•Âøó (Â¶ÇÈúÄÊç¢Ë°åËØ∑Áî®','ÈöîÂºÄ)",type:"textarea",class:"mb-3"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),t(D,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=l=>V.value=l),title:"Á≥ªÁªüÊèêÁ§∫","ok-text":"üöÄ Á°ÆËÆ§ÂèëÂ∏É","cancel-text":"ÊöÇ‰∏çÂèëÂ∏É",onOk:q,onCancel:R},{header:n(()=>[s("div",ze,[t(se,{name:"warning",color:"warning"}),e[15]||(e[15]=s("span",{class:"header-text"},"ÁâàÊú¨ÂèëÂ∏ÉÁ°ÆËÆ§",-1))])]),default:n(()=>[s("div",Pe,[s("p",Ae,[e[16]||(e[16]=v(" Âç≥Â∞ÜÂèëÂ∏ÉÁâàÊú¨Ôºö")),s("span",Te,h(C.value),1)]),t(oe),e[17]||(e[17]=s("p",{class:"confirm-text"},"ËØ•Êìç‰ΩúÂ∞ÜÁ´ãÂç≥ÁîüÊïà‰∏î‰∏çÂèØÈÄÜËΩ¨ÔºåËØ∑Á°ÆËÆ§ÊòØÂê¶ÁªßÁª≠Ôºü",-1))])]),_:1},8,["modelValue"])]),s("div",Be,[t(te,{modelValue:p.value,"onUpdate:modelValue":[e[9]||(e[9]=l=>p.value=l),ee],"page-size":b.pagesize,"visible-pages":"5",total:g.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),s("span",Me," ÂÖ± "+h(g.value)+" Êù°ËÆ∞ÂΩï ",1)])]),_:1})}}},Ee=me(Fe,[["__scopeId","data-v-b6610991"]]);export{Ee as default};
//# sourceMappingURL=version-BbIuH_e2.js.map
