import{g as Z,u as ee}from"./node-CUMRDwgI.js";import{t as ae}from"./machines-DSl2Pw4f.js";import{b as te,i as oe}from"./date-BwSFrXps.js";import{u as le}from"./useToast-BCq51KsU.js";import{_ as se,r as s,U,B as ne,g as re,w as n,f as c,a as k,b as u,h as r,u as ce,i as w,t as d,c as P,F as N}from"./index-BXWjwjDN.js";import"./request-DFZXn-Tp.js";const ie={class:"mb-4"},ue={class:"filters-row"},de={class:"mb-4"},pe={class:"va-h6"},me={class:"table-responsive"},_e=["title"],ve=["title"],fe={class:"flex justify-end mt-4"},ge={class:"ml-4 self-center text-gray-600"},ye={__name:"tao_revenue",setup(be){const{init:C}=le(),p=s(),v=s(),T=s(""),O=s([]),f=s(O[0]),z=s(0),S=s(""),B=a=>a.map(e=>({value:e,text:e})),g=async()=>{try{const a=await ae(),e={value:"",text:"所有"};O.value=[e,...B(a||[])]}catch(a){console.error("接口调用失败:",a)}},F=(a,e)=>{if(!a)return"";if(a.length<=e)return a;const o="...";if(e<=o.length)return o.slice(0,e);const _=e-o.length,i=Math.floor(_/2),x=_-i;return a.slice(0,i)+o+a.slice(-x)},V=s(1),y=s(0),D=s([]),M=s(!1),m=U({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),I=a=>{if(!a)return"";const e=new Date(a),o=e.getFullYear(),_=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${o}-${_}-${i}`},b=async()=>{var a;M.value=!0;try{const e={page:m.page,pagesize:m.pagesize,currency:"tao",group:(a=f.value)==null?void 0:a.value,hotkey:v.value};p.value&&(e.date=I(p.value));const o=await Z(e);o!=null&&o.pool_profits?(D.value=o.pool_profits,y.value=o.total,z.value=o.total_profit,S.value=te(o.pool_profits[0].timestamp)):(D.value=[],y.value=0)}catch(e){console.error("获取数据失败:",e),C({message:e.message||"获取数据失败",color:"danger"}),D.value=[],y.value=0}finally{M.value=!1}};ne([p,T,f,v],()=>{m.page=1,V.value=1,b(),g()});const $=[{key:"id",label:"ID",width:"100px"},{key:"record_date",label:"记录日期",width:"160px"},{key:"group",label:"分组",width:"160px"},{key:"profit",label:"收益"},{key:"hotkey",label:"Hotkey",width:"240px"},{key:"coldkey",label:"Coldkey",width:"240px"},{key:"subnet",label:"子网"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],h=s(!1),l=U({id:null,real_power:"",real_reward:"",need_allocate:""}),W=[{value:"1",text:"是"},{value:"0",text:"否"}],A=a=>a===1||a==="1"?"是":"否",E=a=>{l.id=a.rowData.id,l.real_power=a.rowData.real_power,l.real_reward=a.rowData.real_reward,l.need_allocate=a.rowData.need_allocate===1?"是":"否",h.value=!0},H=async()=>{var a;try{const e=await ee(l.id,{real_power:Number(l.real_power),real_reward:Number(l.real_reward),need_allocate:Number((a=l.need_allocate)==null?void 0:a.value)});C({message:e,color:"success"}),await b(),await g(),h.value=!1}catch(e){console.error("修改失败:",e),C({message:e.message||"修改失败",color:"danger"})}},j=()=>{h.value=!1,q()},q=()=>{l.id=null,l.real_power="",l.real_reward="",l.need_allocate=""},G=a=>{m.page=Math.ceil(a/m.pagesize),V.value=a,b(),g()},R=()=>{p.value=null,f.value="",T.value="",v.value="",b(),g()};return b(),g(),(a,e)=>{const o=c("va-input"),_=c("va-date-input"),i=c("va-select"),x=c("va-button"),Y=c("va-button-group"),J=c("VaDataTable"),K=c("VaForm"),L=c("VaModal"),Q=c("VaPagination"),X=c("va-card");return k(),re(X,{class:"machines-list"},{default:n(()=>[u("div",ie,[u("div",ue,[r(o,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"搜索地址名",class:"mr-5",style:{maxWidth:"13%"}},{prepend:n(()=>e[6]||(e[6]=[])),_:1},8,["modelValue"]),r(_,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":t=>!ce(oe)(t)},null,8,["modelValue","allowed-days"]),r(i,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),options:O.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),r(x,{onClick:R,class:"",color:"rgb(47, 148, 172)"},{default:n(()=>e[7]||(e[7]=[w(" 重置 ")])),_:1})])]),u("div",de,[u("h4",pe," 总收益: "+d(z.value)+" TAO (最近更新时间:"+d(S.value)+") ",1)]),u("div",me,[r(J,{items:D.value,columns:$,striped:"",class:"responsive-table"},{"cell(record_date)":n(({value:t})=>[w(d(t?t.split("T")[0]:""),1)]),"cell(need_allocate)":n(({value:t})=>[w(d(A(t)),1)]),"cell(hotkey)":n(({value:t})=>[t?(k(),P("a",{key:1,title:t,target:"_blank"},d(F(t,20)),9,_e)):(k(),P(N,{key:0},[w("无")],64))]),"cell(coldkey)":n(({value:t})=>[t?(k(),P("a",{key:1,title:t,target:"_blank"},d(F(t,20)),9,ve)):(k(),P(N,{key:0},[w("无")],64))]),"cell(actions)":n(({row:t})=>[r(Y,null,{default:n(()=>[r(x,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:he=>E(t)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),r(L,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=t=>h.value=t),title:"修改记录",onCancel:j,onOk:H},{default:n(()=>[r(K,null,{default:n(()=>[r(i,{modelValue:l.need_allocate,"onUpdate:modelValue":e[3]||(e[3]=t=>l.need_allocate=t),label:"是否需要分配",options:W,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),u("div",fe,[r(Q,{modelValue:V.value,"onUpdate:modelValue":[e[5]||(e[5]=t=>V.value=t),G],"page-size":m.pagesize,"visible-pages":"5",total:y.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),u("span",ge," 共 "+d(y.value)+" 条记录 ",1)])]),_:1})}}},Ce=se(ye,[["__scopeId","data-v-10c03f3c"]]);export{Ce as default};
//# sourceMappingURL=tao_revenue-arZoN0LW.js.map
