import{g as G,a as J}from"./request-CyVb8btO.js";import{b as C}from"./date-CMM1G54V.js";import{u as K}from"./useToast-D8MyLy3n.js";import{_ as Q,r as c,U as P,B as X,g as Z,w as t,f as r,a as ee,b,h as s,i as u,t as p,u as z}from"./index-CVBAPNBq.js";function ae(y){return G("/api/v1/back_stage/pre_allocate/pool_profits/daily",y)}function le(y,m){return J(`/api/v1/back_stage/pre_allocate/pool_profits/modify?id=${y}`,m)}const oe={class:"mb-4"},te={class:"filters-row"},se={class:"table-responsive"},re={class:"flex justify-end mt-4"},ne={class:"ml-4 self-center text-gray-600"},ce={__name:"list",setup(y){const{init:m}=K(),_=c(),V=c(""),S=c([{value:"aleo",text:"Aleo"}]),w=c(1),v=c(0),k=c([]),x=c(!1),d=P({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:"aleo"}),U=l=>{if(!l)return"";const e=new Date(l),n=e.getFullYear(),D=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${n}-${D}-${g}`},i=async()=>{var l;x.value=!0;try{const e={page:d.page,pagesize:d.pagesize,currency:((l=V.value)==null?void 0:l.value)||"aleo"};_.value&&(e.date=U(_.value));const n=await ae(e);n!=null&&n.pool_profits?(k.value=n.pool_profits,v.value=n.total):(k.value=[],v.value=0)}catch(e){console.error("获取数据失败:",e),m({message:e.message||"获取数据失败",color:"danger"}),k.value=[],v.value=0}finally{x.value=!1}};X([_,V],()=>{d.page=1,w.value=1,i()});const I={0:"未知",1:"zkwork",2:"oula",3:"daxiang"},T=[{key:"id",label:"ID"},{key:"record_date",label:"记录日期"},{key:"reward",label:"奖励"},{key:"real_reward",label:"实际奖励"},{key:"power",label:"算力"},{key:"real_power",label:"实际算力"},{key:"currency",label:"币种"},{key:"pool_type",label:"矿池类型"},{key:"group",label:"分组"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],f=c(!1),o=P({id:null,real_power:"",real_reward:"",need_allocate:""}),F=[{value:"1",text:"是"},{value:"0",text:"否"}],M=l=>l===1||l==="1"?"是":"否",N=l=>{o.id=l.rowData.id,o.real_power=l.rowData.real_power,o.real_reward=l.rowData.real_reward,o.need_allocate=l.rowData.need_allocate===1?"是":"否",f.value=!0},O=async()=>{var l;try{console.log("editForm.need_allocate is",o.need_allocate);const e=await le(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((l=o.need_allocate)==null?void 0:l.value)});m({message:e,color:"success"}),await i(),f.value=!1}catch(e){console.error("修改失败:",e),m({message:e.message||"修改失败",color:"danger"})}},$=()=>{f.value=!1,B()},B=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},A=l=>{d.page=Math.ceil(l/d.pagesize),w.value=l,i()},H=()=>{i()},R=()=>{i()};return i(),(l,e)=>{const n=r("va-date-input"),D=r("va-select"),g=r("va-button"),W=r("va-button-group"),j=r("VaDataTable"),h=r("VaInput"),q=r("VaForm"),E=r("VaModal"),L=r("VaPagination"),Y=r("va-card");return ee(),Z(Y,{class:"machines-list"},{default:t(()=>[b("div",oe,[b("div",te,[s(n,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),placeholder:"选择日期",class:"filter-item mr-5",style:{maxWidth:"20%"}},null,8,["modelValue"]),s(D,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=a=>V.value=a),options:S.value,placeholder:"币种筛选",class:"filter-item mr-5",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),s(g,{onClick:H,class:"ml-5"},{default:t(()=>e[7]||(e[7]=[u(" 搜索 ")])),_:1}),s(g,{onClick:R,class:"ml-5"},{default:t(()=>e[8]||(e[8]=[u(" 刷新 ")])),_:1})])]),b("div",se,[s(j,{items:k.value,columns:T,striped:"",class:"responsive-table"},{"cell(record_date)":t(({value:a})=>[u(p(a?a.split("T")[0]:""),1)]),"cell(power)":t(({value:a})=>[u(p(z(C)(a)),1)]),"cell(real_power)":t(({value:a})=>[u(p(z(C)(a)),1)]),"cell(need_allocate)":t(({value:a})=>[u(p(M(a)),1)]),"cell(pool_type)":t(({value:a})=>[u(p(I[a]||"未知"),1)]),"cell(actions)":t(({row:a})=>[s(W,null,{default:t(()=>[s(g,{small:"",icon:"edit",color:"primary",onClick:ue=>N(a)},null,8,["onClick"])]),_:2},1024)]),default:t(()=>[e[9]||(e[9]=u(" formatHashRate "))]),_:1},8,["items"]),s(E,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),title:"修改记录",onCancel:$,onOk:O},{default:t(()=>[s(q,null,{default:t(()=>[s(h,{modelValue:o.real_power,"onUpdate:modelValue":e[2]||(e[2]=a=>o.real_power=a),label:"实际算力",type:"number",placeholder:"请输入实际算力",class:"mb-2"},null,8,["modelValue"]),s(h,{modelValue:o.real_reward,"onUpdate:modelValue":e[3]||(e[3]=a=>o.real_reward=a),label:"实际奖励",type:"number",placeholder:"请输入实际奖励",class:"mb-2"},null,8,["modelValue"]),s(D,{modelValue:o.need_allocate,"onUpdate:modelValue":e[4]||(e[4]=a=>o.need_allocate=a),label:"是否需要分配",options:F,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),b("div",re,[s(L,{modelValue:w.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>w.value=a),A],"page-size":d.pagesize,"visible-pages":"5",total:v.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),b("span",ne," 共 "+p(v.value)+" 条记录 ",1)])]),_:1})}}},_e=Q(ce,[["__scopeId","data-v-65198681"]]);export{_e as default};
//# sourceMappingURL=list-IpkTVMkJ.js.map
