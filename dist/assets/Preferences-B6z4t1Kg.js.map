{"version":3,"file":"Preferences-B6z4t1Kg.js","sources":["../../src/stores/user-store.ts","../../src/pages/preferences/preferences-header/PreferencesHeader.vue","../../src/pages/preferences/styles.ts","../../src/pages/preferences/settings/Settings.vue","../../src/pages/preferences/modals/EditNameModal.vue","../../src/pages/preferences/modals/EditAuthenticationModal.vue","../../src/pages/preferences/Preferences.vue"],"sourcesContent":["import { defineStore } from \"pinia\";\n\nexport const useUserStore = defineStore(\"user\", {\n  state: () => {\n    return {\n      userName: \"Vasili Savitski\",\n      email: \"vasili@gmail.com\",\n      memberSince: \"8/12/2020\",\n      pfp: \"https://picsum.photos/id/22/200/300\",\n      is2FAEnabled: false,\n    };\n  },\n\n  actions: {\n    toggle2FA() {\n      this.is2FAEnabled = !this.is2FAEnabled;\n    },\n\n    changeUserName(userName: string) {\n      this.userName = userName;\n    },\n  },\n});\n","<template>\n  <!-- <VaAvatar size=\"large\" color=\"warning\"\n    >\n    <span class=\"text-4xl\"> 😍 </span></VaAvatar\n  > -->\n  <VaAvatar color=\"warning\"> U.M </VaAvatar>\n  <div class=\"flex flex-col justify-center\">\n    <h2 class=\"text-[28px] md:text-[32px] leading-10 font-bold\">\n      <!-- {{ store.userName }} -->\n        {{ user }}\n    </h2>\n    <!-- <div class=\"flex space-x-1 text-[13px] leading-4\">\n      <p>Member since</p>\n      <p>{{ store.memberSince }}</p>\n    </div> -->\n  </div>\n</template>\n<script lang=\"ts\" setup>\nimport { useUserStore } from \"../../../stores/user-store\";\nimport{ getUser } from \"../../../utils/auth\";\nconst user = getUser();\nconst store = useUserStore();\n</script>\n","export const buttonStyles = {\n  \"--va-button-font-size\": \"14px\",\n  \"--va-button-line-height\": \"20px\",\n};\n","<template>\n  <div\n    class=\"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-6 min-h-[36px] leading-5\"\n  >\n    <p class=\"font-bold w-[200px]\">绑定谷歌认证器</p>\n    <div class=\"flex-1\">\n      <div class=\"max-w-[748px]\">\n        <!-- {{ twoFA.content }} -->\n        为您的帐户增加一层额外的安全保护。\n        登录时，除了用户名和密码外，您还需要提供一个谷歌验证码（安全认证器）。\n      </div>\n    </div>\n    <VaButton\n      v-if=\"umpoolISGoogle==0\"\n      :style=\"buttonStyles\"\n      class=\"w-fit h-fit\"\n      preset=\"primary\"\n      @click=\"emits('openAuthenticationModal')\"\n    >\n      绑定\n    </VaButton>\n    <!-- <VaButton\n      :style=\"buttonStyles\"\n      class=\"w-fit h-fit\"\n      preset=\"primary\"\n      :color=\"twoFA.color\"\n      @click=\"toggle2FA\"\n    >\n      {{ twoFA.button }}\n    </VaButton> -->\n  </div>\n  <VaDivider />\n \n</template>\n<script lang=\"ts\" setup>\nimport { computed,ref,onMounted } from \"vue\";\n\nimport { useToast } from \"vuestic-ui\";\n\nimport { useUserStore } from \"../../../stores/user-store\";\nimport {isNeedGoogle} from \"../../../api/user\";\nimport { getUser } from \"../../../utils/auth\";\n\nimport { buttonStyles } from \"../styles\";\nconst store = useUserStore();\n\nconst { init } = useToast();\nconst umpoolISGoogle=ref(0)// 判断umpool是否有谷歌认证\n\nonMounted(async () => {\n  await checkUserGoogleCode();\n});\nconst checkUserGoogleCode = async () => {\n  try {\n    const username=getUser();\n    const res = await isNeedGoogle(username);\n    // console.log(res);\n    umpoolISGoogle.value = res;\n  } catch (error) {\n    console.error(\"Error checking Google code requirement:\", error);\n  }\n}\n\nconst toastMessage = computed(() =>\n  store.is2FAEnabled ? \"2FA successfully enabled\" : \"2FA successfully disabled\",\n);\n\nconst twoFA = computed(() => {\n  if (store.is2FAEnabled) {\n    return {\n      color: \"danger\",\n      button: \"Disable 2FA\",\n      content:\n        \"Two-Factor Authentication (2FA) is now enabled for your account, adding an extra layer of security to your sign-ins.\",\n    };\n  } else {\n    return {\n      color: \"primary\",\n      button: \"Set up 2FA\",\n      content:\n        \"Add an extra layer of security to your account. To sign in, you’ll need to provide a code along with your username and password.\",\n    };\n  }\n});\n\nconst toggle2FA = () => {\n  store.toggle2FA();\n  init({ message: toastMessage.value, color: \"success\" });\n};\n\nconst emits = defineEmits([\"openNameModal\", \"openResetPasswordModal\"]);\n\n</script>\n","<template>\n  <VaModal\n    :mobile-fullscreen=\"false\"\n    size=\"small\"\n    hide-default-actions\n    max-width=\"380px\"\n    model-value\n    close-button\n    @update:modelValue=\"emits('cancel')\"\n  >\n    <h1 class=\"va-h5 mb-4\">Reset password</h1>\n    <VaForm ref=\"form\" @submit.prevent=\"submit\">\n      <VaInput v-model=\"Name\" class=\"mb-4\" label=\"Name\" placeholder=\"Name\" />\n      <div\n        class=\"flex flex-col-reverse md:flex-row md:items-center md:justify-end md:space-x-4\"\n      >\n        <VaButton\n          :style=\"buttonStyles\"\n          preset=\"secondary\"\n          color=\"secondary\"\n          @click=\"emits('cancel')\"\n        >\n          Cancel</VaButton\n        >\n        <VaButton\n          :style=\"buttonStyles\"\n          class=\"mb-4 md:mb-0\"\n          type=\"submit\"\n          @click=\"submit\"\n        >\n          Save</VaButton\n        >\n      </div>\n    </VaForm>\n  </VaModal>\n</template>\n<script lang=\"ts\" setup>\nimport { ref } from \"vue\";\nimport { useUserStore } from \"../../../stores/user-store\";\n\nimport { buttonStyles } from \"../styles\";\nimport { useToast } from \"vuestic-ui\";\n\nconst store = useUserStore();\n\nconst { init } = useToast();\n\nconst emits = defineEmits([\"cancel\"]);\n\nconst Name = ref<string>(store.userName);\n\nconst submit = () => {\n  if (!Name.value || Name.value === store.userName) {\n    return emits(\"cancel\");\n  }\n\n  store.changeUserName(Name.value);\n  init({ message: \"You've successfully changed your name\", color: \"success\" });\n  emits(\"cancel\");\n};\n</script>\n\n<style lang=\"scss\">\n// TODO temporary before https://github.com/epicmaxco/vuestic-ui/issues/4020 fix\n.va-modal__inner {\n  min-width: 326px;\n}\n</style>\n","<template>\n    <VaModal\n      :mobile-fullscreen=\"false\"\n      size=\"small\"\n      hide-default-actions\n      max-width=\"380px\"\n      model-value\n      close-button\n      @update:modelValue=\"emits('cancel')\"\n    >\n      <h1 class=\"va-h5 mb-4\">谷歌认证</h1>\n      <!-- <VaForm ref=\"form\" @submit.prevent=\"submit\"> -->\n        <VaForm ref=\"form\">  \n\n        <VaImage\n          class=\"w-full md:w-1/2 lg:w-1/3\"\n          :src=\"googleInfo?.qr_secret\"\n        />\n       <div class=\"mt-4\" @click=\"copyText(googleInfo?.secret)\"> {{ googleInfo?.secret}}\n\n        <VaIcon  class=\"material-icons\">\n              content_copy\n          </VaIcon>\n       </div>\n        <!-- <VaInput v-model=\"googleInfo?.secret\" class=\"mb-4\" label=\"Email\" placeholder=\"谷歌密钥\" /> -->\n        <VaInput v-model=\"google_code\" class=\"mb-4\" label=\"Name\" placeholder=\"请输入谷歌认证码\" />\n        <div\n          class=\"flex flex-col-reverse md:flex-row md:items-center md:justify-end md:space-x-4\"\n        >\n          <VaButton\n            :style=\"buttonStyles\"\n            preset=\"secondary\"\n            color=\"secondary\"\n            @click=\"emits('cancel')\"\n          >\n            Cancel</VaButton\n          >\n          <VaButton\n            :style=\"buttonStyles\"\n            class=\"mb-4 md:mb-0\"\n            type=\"submit\"\n            @click=\"submit\"\n          >\n            Save</VaButton\n          >\n        </div>\n      </VaForm>\n    </VaModal>\n  </template>\n  <script lang=\"js\" setup>\n  import { ref } from \"vue\";\n  import { useUserStore } from \"../../../stores/user-store\";\n  import { getUser } from \"../../../utils/auth\";\n  import { getGoogle, bindGoogleCode } from \"../../../api/user\";\n  import { buttonStyles } from \"../styles\";\n  import { useToast } from \"vuestic-ui\";\n  \n  const store = useUserStore();\n  \n  const { init } = useToast();\n  \n  const emits = defineEmits([\"cancel\"]);\n  const form = ref();\n  // const Name = ref<string>(store.userName);\n  const googleInfo = ref();\n  const google_code = ref('');\n  \n  const submit=()=>{\n    if (!google_code.value) {\n      const toastMessage = \"谷歌认证码错误\";    \n      init({ message: toastMessage, color: \"danger\" });    \n    }\n    if (google_code.value) {\n      const username=getUser(); \n      bindGoogleCode({user_name:username, google_code:google_code.value}).then(res=>{ \n        if(res==1){\n          init({ message: \"谷歌认证绑定成功\", color: \"success\" }); \n          emits('cancel') \n          window.location.reload();\n        }else{\n          init({ message: \"谷歌认证绑定失败\", color: \"danger\" }); \n          emits('cancel') \n        }\n      }).catch(err=>{\n        init({ message: \"谷歌认证绑定失败\", color: \"danger\" }); \n        emits('cancel') \n      })  \n    }\n    \n  };\n\n\nconst getGoogleInfo=async()=>{\n  const username=getUser(); \n  const res=await getGoogle(username);\n  // console.log(res);\n  googleInfo.value=res;\n  console.log(googleInfo.value);\n}\ngetGoogleInfo();\n\n// 复制功能\nconst copyText = async (text) => {\n \n//  try {\n//    await navigator.clipboard.writeText(text)\n//    init({ message: \"复制成功\",color: \"success\"})\n//  } catch (err) {\n//    init({ message: '复制失败', color: 'danger' })\n//  }\n\n\n if (navigator.clipboard) {\n    navigator.clipboard.writeText(text).then(() => {\n      // console.log('复制成功');\n      init({ message: \"复制成功\",color: \"success\"})\n    }).catch(err => {\n      // console.error('复制失败', err);\n      init({ message: '复制失败', color: 'danger' })\n    });\n  } else {\n    // 备用方式，比如使用 document.execCommand()\n    const textarea = document.createElement('textarea');\n    textarea.value = text;\n    document.body.appendChild(textarea);\n    textarea.select();\n    document.execCommand('copy');\n    document.body.removeChild(textarea);\n    // console.log('复制成功');\n    init({ message: \"复制成功\",color: \"success\"})\n  }\n\n\n\n}\n</script>\n  \n<style lang=\"scss\">\n  // TODO temporary before https://github.com/epicmaxco/vuestic-ui/issues/4020 fix\n  .va-modal__inner {\n    min-width: 326px;\n  }\n  </style>\n  ","<template>\n  <h1 class=\"page-title\">双重认证</h1>\n  <div class=\"flex flex-col p-4 space-y-10 bg-backgroundSecondary rounded-lg\">\n    <div class=\"flex space-x-5\">\n      <PreferencesHeader />\n    </div>\n    <div class=\"space-y-4 md:space-y-6\">\n      <Settings\n        @openNameModal=\"isEditNameModalOpen = true\"\n        @openResetPasswordModal=\"isResetPasswordModalOpen = true\"\n        @openAuthenticationModal=\"isEditAuthenticationModalOpen = true\"\n      />\n    </div>\n  </div>\n  <EditNameModal\n    v-if=\"isEditNameModalOpen\"\n    @cancel=\"isEditNameModalOpen = false\"\n  />\n  <EditAuthenticationModal\n    v-if=\"isEditAuthenticationModalOpen\"\n    @cancel=\"isEditAuthenticationModalOpen = false\"\n  />\n   <!--<ResetPasswordModal\n    v-if=\"isResetPasswordModalOpen\"\n    @cancel=\"isResetPasswordModalOpen = false\"\n  /> -->\n</template>\n<script lang=\"ts\" setup>\nimport { ref } from \"vue\";\n\nimport PreferencesHeader from \"./preferences-header/PreferencesHeader.vue\";\nimport Settings from \"./settings/Settings.vue\";\nimport EditNameModal from \"./modals/EditNameModal.vue\";\nimport EditAuthenticationModal  from \"./modals/EditAuthenticationModal.vue\";\n// import ResetPasswordModal from \"./modals/ResetPasswordModal.vue\";\n\nconst isEditNameModalOpen = ref(false);\nconst isResetPasswordModalOpen = ref(false);\nconst isEditAuthenticationModalOpen = ref(false);\n</script>\n"],"names":["useUserStore","defineStore","userName","user","getUser","buttonStyles","store","useToast","umpoolISGoogle","ref","onMounted","checkUserGoogleCode","username","res","isNeedGoogle","error","computed","emits","__emit","init","Name","submit","form","googleInfo","google_code","bindGoogleCode","err","getGoogle","copyText","text","textarea","isEditNameModalOpen","isResetPasswordModalOpen","isEditAuthenticationModalOpen"],"mappings":"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"}