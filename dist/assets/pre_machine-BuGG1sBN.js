import{m as ae,p as te,b as le}from"./machines-BxmdfteP.js";import{g as B,a as P,i as oe,f as se,b as ne}from"./date-CMM1G54V.js";import{_ as re,G as ie,r as i,U as S,B as de,g as ue,w as n,f as d,a as F,b as w,i as u,h as o,u as p,t as v,c as me,k as ce,W}from"./index-B3aTDmKr.js";import{u as pe}from"./useToast-FctfAaky.js";import"./request-B9dpD8q3.js";const ve={class:"mb-4"},_e={class:"table-responsive"},be={key:0,class:"va-text-danger"},ge={class:"flex justify-end mt-4"},fe={class:"ml-4 self-center text-gray-600"},Ve={__name:"pre_machine",setup(ye){const{t:s}=ie(),{init:y}=pe(),O=[{value:"0",text:"是"},{value:"1",text:"否"}],U=i([]),m=i(B(8)),_=i(""),h=i(O[0]),b=i(U[0]),g=i(!1),l=S({id:null,online_points:0,hashrate:0,record_date:""}),c=i(""),A=a=>{const e=Number(a.data);console.log("num is",e),isNaN(e)?c.value="必须输入数字":Number.isInteger(e)?e<0||e>288?c.value="范围0~288":c.value="":c.value="必须为整数"},$=a=>a.map(e=>({value:e,text:e})),T=async()=>{try{const a=await ae(),e={value:"",text:"所有"};U.value=[e,...$(a.groups||[])]}catch(a){console.error("接口调用失败:",a)}},k=i(1),D=i(100),M=i([]),I=i(!1),f=S({page:1,pagesize:10}),E=[{key:"mid",label:s("admin.mid")},{key:"hostname",label:s("admin.mName")},{key:"record_date",label:s("admin.recordDate")},{key:"currency",label:s("admin.currency")},{key:"uid",label:s("admin.userUid")},{key:"sub_user_name",label:s("admin.subUserName")},{key:"online_time",label:s("admin.onlineTimes")},{key:"online_points",label:s("admin.onlinePoints")},{key:"hashrate",label:s("admin.avgHashrate")},{key:"is_in_black_list",label:s("admin.needAllocate")},{key:"group",label:s("admin.groupName")},{key:"actions",label:s("admin.operation")}],G=a=>{f.page=Math.ceil(a/f.pagesize),k.value=a,V()},z=a=>{if(!a)return"";const e=new Date(a),r=e.getFullYear(),N=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${r}-${N}-${x}`},V=async()=>{var a;I.value=!0;try{const e={...f,is_in_black_list:h.value.value,hostname:_.value,group:(a=b.value)==null?void 0:a.value};m.value&&(e.record_date=z(m.value));const r=await te(e);r&&Array.isArray(r.machine_info)&&typeof r.total=="number"?(M.value=r.machine_info,D.value=r.total):r.machine_info===null?(M.value=[],D.value=0):y({message:"查询错误",color:"danger"})}catch(e){console.error("获取数据失败:",e),y({message:"获取数据失败",color:"danger"})}finally{I.value=!1}};de([m,h,b,_],()=>{f.page=1,k.value=1,V()});const H=a=>{l.id=a.rowData.id,l.hostname=a.rowData.hostname,l.online_points=a.rowData.online_points,l.hashrate=a.rowData.hashrate,l.record_date=P(a.rowData.record_date),g.value=!0},Y=a=>a===0||a==="0"?"是":"否",j=()=>{g.value=!1,R()},q=()=>{_.value="",b.value="",m.value&&(m.value=z(B(8))),V(),T()},L=async()=>{try{console.log("record_date is",l.record_date);const a=await le({hostname:l.hostname,record_date:l.record_date,online_points:l.online_points,hashrate:l.hashrate});y({message:a,color:"success"}),await V(),g.value=!1}catch(a){console.error("更新失败:",a),y({message:a,color:"danger"})}},R=()=>{l.id=null,l.online_points=0,l.hashrate=0};return V(),T(),(a,e)=>{const r=d("va-input"),N=d("va-date-input"),x=d("va-select"),J=d("va-button-group"),K=d("VaDataTable"),C=d("VaInput"),Q=d("VaForm"),X=d("VaModal"),Z=d("VaPagination"),ee=d("va-card");return F(),ue(ee,{class:"machines-list"},{default:n(()=>[w("div",ve,[e[12]||(e[12]=u(" 机器名： ")),o(r,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"搜索机器名",class:"mb-1 mr-8",style:{maxWidth:"15%"}},{prepend:n(()=>e[10]||(e[10]=[])),_:1},8,["modelValue"]),e[13]||(e[13]=u(" 记录日期： ")),o(N,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),placeholder:"选择日期",class:"mb-1 mr-5",style:{maxWidth:"16%"},"allowed-days":t=>!p(oe)(t)},null,8,["modelValue","allowed-days"]),e[14]||(e[14]=u(" 分组： ")),o(x,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:U.value,placeholder:"组名",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),e[15]||(e[15]=u(" 参与分配： ")),o(x,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),options:O,placeholder:"是否参与分配",class:"filter-item mb-1 mr-8",style:{maxWidth:"10%"}},null,8,["modelValue"]),o(p(W),{onClick:q,class:"mb-1 mr-8",color:"rgb(47, 148, 172)"},{default:n(()=>e[11]||(e[11]=[u(" 刷新 ")])),_:1})]),w("div",_e,[o(K,{items:M.value,columns:E,striped:"",class:"responsive-table"},{"cell(created_time)":n(({value:t})=>[u(v(p(se)(t)),1)]),"cell(hashrate)":n(({value:t})=>[u(v(p(ne)(t)),1)]),"cell(record_date)":n(({value:t})=>[u(v(p(P)(t)),1)]),"cell(is_in_black_list)":n(({value:t})=>[u(v(Y(t)),1)]),"cell(actions)":n(({row:t})=>[o(J,null,{default:n(()=>[o(p(W),{size:"small",color:"rgb(47, 148, 172)",icon:"edit",onClick:he=>H(t)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),o(X,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=t=>g.value=t),title:"修改机器信息",onCancel:j,onOk:L},{default:n(()=>[o(Q,null,{default:n(()=>[o(C,{modelValue:l.hostname,"onUpdate:modelValue":e[4]||(e[4]=t=>l.hostname=t),label:"机器名",class:"mb-2",readonly:""},null,8,["modelValue"]),o(C,{modelValue:l.record_date,"onUpdate:modelValue":e[5]||(e[5]=t=>l.record_date=t),label:"记录日期",class:"mb-2",readonly:""},null,8,["modelValue"]),o(r,{modelValue:l.online_points,"onUpdate:modelValue":e[6]||(e[6]=t=>l.online_points=t),label:"在线时长点数",type:"number",placeholder:"请输入0~288的整数",min:0,max:288,"selected-top-shown":"",class:"mb-2",onInput:A},{messages:n(()=>[c.value?(F(),me("div",be,v(c.value),1)):ce("",!0)]),_:1},8,["modelValue"]),o(C,{modelValue:l.hashrate,"onUpdate:modelValue":e[7]||(e[7]=t=>l.hashrate=t),label:"算力",type:"number",placeholder:"请输入算力",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),w("div",ge,[o(Z,{modelValue:k.value,"onUpdate:modelValue":[e[9]||(e[9]=t=>k.value=t),G],"page-size":f.pagesize,"visible-pages":"5",total:D.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),w("span",fe," 共 "+v(D.value)+" 条记录 ",1)])]),_:1})}}},Me=re(Ve,[["__scopeId","data-v-91ba42e8"]]);export{Me as default};
//# sourceMappingURL=pre_machine-BuGG1sBN.js.map
