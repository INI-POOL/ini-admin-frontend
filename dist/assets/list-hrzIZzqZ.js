import{m as Z,a as ee,u as le}from"./machines-C-0oEYe1.js";import{f as ae,c as se}from"./date-CMM1G54V.js";import{u as oe}from"./useToast-BidcVFBG.js";import{_ as te,r as t,U as F,g as ne,w as n,f as u,a as ue,b as d,h as o,i as m,t as V,u as P}from"./index-CjJnDUq4.js";import"./request-B51gDq5N.js";const re={class:"mb-4"},ie={class:"filters-row mt-4"},de={class:"table-responsive"},me={class:"flex justify-end mt-4"},ce={class:"ml-4 self-center text-gray-600"},pe={__name:"list",setup(_e){const{init:c}=oe(),y=t(""),f=t(""),g=t(""),k=t(""),U=t(""),h=t(""),D=t([]),I=t([]),T=t([]),r=t(!1),s=F({id:null,hostname:"",sub_user_name:"",currency:"",group:"",is_in_black_list:""}),w=t(1),p=t(100),x=t([]),W=t(!1),_=F({page:1,pagesize:10}),B=[{value:"0",text:"是"},{value:"1",text:"否"}],C=l=>l.map(e=>({value:e,text:e})),z=async()=>{try{const l=await Z();D.value=C(l.currencies||[]),I.value=C(l.idcs||[]),T.value=C(l.sub_users||[])}catch(l){console.error("接口调用失败:",l)}},A=[{key:"id",label:"机器ID"},{key:"hostname",label:"机器名"},{key:"idc",label:"机房"},{key:"currency",label:"币种"},{key:"model_name",label:"机器类型"},{key:"uid",label:"用户UID"},{key:"sub_user_name",label:"子账户名"},{key:"mobile",label:"手机号"},{key:"last_seen",label:"最近提交时间"},{key:"created_time",label:"创建时间"},{key:"is_in_black_list",label:"是否参与分配"},{key:"actions",label:"操作"}],L=l=>{_.page=Math.ceil(l/_.pagesize),w.value=l,i()},i=async()=>{W.value=!0;try{const l={..._,mobile:f.value,hostname:y.value,sub_user_name:g.value,currency:k.value.value,uid:U.value,idc:h.value.value},e=await ee(l);e&&Array.isArray(e.machines)&&typeof e.total=="number"?(x.value=e.machines,p.value=e.total):e.machines===null?(x.value=[],p.value=0):c({message:"查询错误",color:"danger"})}catch(l){console.error("获取数据失败:",l),c({message:"获取数据失败",color:"danger"})}finally{W.value=!1}},N=()=>{i()},j=l=>{s.id=l.rowData.id,s.hostname=l.rowData.hostname,s.sub_user_name=l.rowData.sub_user_name+" ("+l.rowData.uid+")",s.currency=l.rowData.currency,s.group=l.rowData.group,s.idc=l.rowData.idc,s.is_in_black_list=S(l.rowData.is_in_black_list),r.value=!0},S=l=>l===0||l==="0"?"是":"否",q=()=>{r.value=!1,G()},E=()=>{i(),z()},$=async()=>{try{let l=s.sub_user_name.value;l!=null&&(l=l.substring(0,l.indexOf(" ")));const e=await le(s.id,{hostname:s.hostname,sub_user_name:l,idc:s.idc,currency:s.currency.value,is_in_black_list:s.is_in_black_list.value,group:s.group});c({message:e,color:"success"}),await i(),r.value=!1}catch(l){console.error("更新失败:",l),c({message:"更新失败",color:"danger"})}},G=()=>{s.id=null,s.hostname="",s.sub_user_name=""};return i(),z(),(l,e)=>{const v=u("va-input"),b=u("va-select"),O=u("va-button"),H=u("va-button-group"),J=u("VaDataTable"),M=u("VaInput"),K=u("VaSelect"),Q=u("VaForm"),R=u("VaModal"),X=u("VaPagination"),Y=u("va-card");return ue(),ne(Y,{class:"machines-list"},{default:n(()=>[d("div",re,[o(v,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),placeholder:"搜索机器名",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[14]||(e[14]=[])),_:1},8,["modelValue"]),o(v,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),placeholder:"搜索手机号",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[15]||(e[15]=[])),_:1},8,["modelValue"]),o(v,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),placeholder:"搜索子账户",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[16]||(e[16]=[])),_:1},8,["modelValue"]),o(v,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=a=>U.value=a),placeholder:"搜索用户UID",class:"mb-1 mr-5",style:{maxWidth:"20%"}},{prepend:n(()=>e[17]||(e[17]=[])),_:1},8,["modelValue"]),d("div",ie,[o(b,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),options:D.value,placeholder:"币种筛选",class:"filter-item mr-5",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),o(b,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=a=>h.value=a),options:I.value,placeholder:"机房筛选",class:"filter-item",style:{maxWidth:"16%"}},null,8,["modelValue","options"]),o(O,{onClick:N,class:"ml-5"},{default:n(()=>e[18]||(e[18]=[m(" 搜索 ")])),_:1}),o(O,{onClick:E,class:"ml-5"},{default:n(()=>e[19]||(e[19]=[m(" 刷新 ")])),_:1})])]),d("div",de,[o(J,{items:x.value,columns:A,striped:"",class:"responsive-table"},{"cell(created_time)":n(({value:a})=>[m(V(P(ae)(a)),1)]),"cell(last_seen)":n(({value:a})=>[m(V(P(se)(a)),1)]),"cell(is_in_black_list)":n(({value:a})=>[m(V(S(a)),1)]),"cell(actions)":n(({row:a})=>[o(H,null,{default:n(()=>[o(O,{small:"",icon:"edit",color:"primary",onClick:ve=>j(a)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),o(R,{modelValue:r.value,"onUpdate:modelValue":e[12]||(e[12]=a=>r.value=a),title:"编辑机器信息",onCancel:q,onOk:$},{default:n(()=>[o(Q,null,{default:n(()=>[o(M,{modelValue:s.hostname,"onUpdate:modelValue":e[6]||(e[6]=a=>s.hostname=a),label:"机器名",placeholder:"请输入机器名",class:"mb-2"},null,8,["modelValue"]),o(K,{modelValue:s.sub_user_name,"onUpdate:modelValue":e[7]||(e[7]=a=>s.sub_user_name=a),label:"子账户名",options:T.value,placeholder:"请选择账户","selected-top-shown":"",class:"mb-2"},null,8,["modelValue","options"]),o(b,{modelValue:s.currency,"onUpdate:modelValue":e[8]||(e[8]=a=>s.currency=a),label:"币种",options:D.value,placeholder:"请选择币种","selected-top-shown":"",class:"mb-2"},null,8,["modelValue","options"]),o(M,{modelValue:s.group,"onUpdate:modelValue":e[9]||(e[9]=a=>s.group=a),label:"分组",placeholder:"请输入分组",class:"mb-2"},null,8,["modelValue"]),o(M,{modelValue:s.idc,"onUpdate:modelValue":e[10]||(e[10]=a=>s.idc=a),label:"机房",placeholder:"请输入机房",class:"mb-2"},null,8,["modelValue"]),o(b,{modelValue:s.is_in_black_list,"onUpdate:modelValue":e[11]||(e[11]=a=>s.is_in_black_list=a),label:"是否参与分配",options:B,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),d("div",me,[o(X,{modelValue:w.value,"onUpdate:modelValue":[e[13]||(e[13]=a=>w.value=a),L],"page-size":_.pagesize,"visible-pages":"5",total:p.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),d("span",ce," 共 "+V(p.value)+" 条记录 ",1)])]),_:1})}}},ke=te(pe,[["__scopeId","data-v-0b72a4a4"]]);export{ke as default};
//# sourceMappingURL=list-hrzIZzqZ.js.map
