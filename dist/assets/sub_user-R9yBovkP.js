import{_ as q,r as t,U as R,B as Z,g as C,w as c,f as l,a as h,b as r,h as i,i as T,t as k,u as w,Z as A,c as G,F as H}from"./index-B3aTDmKr.js";import{m as J}from"./machines-BxmdfteP.js";import{g as L,a as Q}from"./request-B9dpD8q3.js";import{t as X}from"./date-CMM1G54V.js";import{u as Y}from"./useToast-FctfAaky.js";function D(d){return L("/api/v1/back_stage/sub_user/list",d)}function ee(d,V){return Q(`/api/v1/back_stage/sub_user/modify/${d}`,V)}const ae={class:"mb-4"},se={class:"table-responsive"},te={class:"editable-rate"},le={class:"flex justify-end mt-4"},ne={class:"ml-4 self-center text-gray-600"},oe={__name:"sub_user",setup(d){const{init:V}=Y(),m=t({}),p=t({}),I=a=>{m.value={...m.value,[a.sub_user_name]:!0},p.value={...p.value,[a.sub_user_name]:Math.round(a.real_rate*100)}},x=async a=>{try{const e=p.value[a.sub_user_name];if(e<0||e>100)throw new Error("费率必须在0-100%之间");await ee(a.sub_user_name,{fee:e/100}),a.real_rate=e/100,m.value={...m.value,[a.sub_user_name]:!1}}catch{}},v=t("aleo"),B=t([]),n=t(""),b=t([]),f=t(1),_=t(0),U=t(!1),u=R({page:1,pagesize:15,currency:"aleo"});t(!1),t(null);const M=a=>a.map(e=>({value:e,text:e})),z=async()=>{try{const a=await J();B.value=M(a.currencies||[])}catch(a){console.error("接口调用失败:",a)}},y=async()=>{var a;U.value=!0;try{const e={page:u.page,pagesize:u.pagesize,currency:((a=v.value)==null?void 0:a.value)||"aleo",sub_user_name:n==null?void 0:n.value},o=await D(e);o!=null&&o.sub_users?(b.value=o.sub_users,_.value=o.total):(b.value=[],_.value=0)}catch(e){console.error("获取数据失败:",e),V({message:e.message||"获取数据失败",color:"danger"}),b.value=[],_.value=0}finally{U.value=!1}};Z([v,n],()=>{u.page=1,f.value=1,y()});const F=[{key:"uid",label:"用户Uid"},{key:"sub_user_name",label:"子账户"},{key:"currency",label:"币种"},{key:"machines",label:"机器数"},{key:"real_rate",label:"费率(%)"},{key:"total_profit",label:"净收益"},{key:"total_fee",label:"手续费"},{key:"created_time",label:"创建时间"}],O=a=>{u.page=Math.ceil(a/u.pagesize),f.value=a,y()},P=()=>{n.value="",y(),z()};return y(),z(),(a,e)=>{const o=l("va-input"),$=l("va-select"),E=l("va-button"),K=l("VaInput"),N=l("VaButton"),S=l("VaDataTable"),W=l("VaPagination"),j=l("va-card");return h(),C(j,{class:"machines-list"},{default:c(()=>[r("div",ae,[i(o,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),label:"子账户",placeholder:"搜索子账户",class:"mb-1 mr-8",style:{maxWidth:"13%"}},{prepend:c(()=>e[3]||(e[3]=[])),_:1},8,["modelValue"]),i($,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),label:"币种",options:B.value,placeholder:"请选择币种","selected-top-shown":"",class:"filter-item mb-1 mr-8",style:{maxWidth:"13%"}},null,8,["modelValue","options"]),i(E,{onClick:P,class:"mt-5 mr-8",color:"rgb(47, 148, 172)"},{default:c(()=>e[4]||(e[4]=[T(" 刷新 ")])),_:1})]),r("div",se,[i(S,{items:b.value,columns:F,striped:"",class:"responsive-table"},{"cell(created_time)":c(({value:s})=>[T(k(w(X)(s)),1)]),"cell(real_rate)":c(({rowData:s,rowIndex:re})=>[r("div",te,[m.value[s.sub_user_name]?(h(),C(K,{key:0,modelValue:p.value[s.sub_user_name],"onUpdate:modelValue":g=>p.value[s.sub_user_name]=g,modelModifiers:{number:!0},type:"number",step:"1",min:"0",max:"100",onKeyup:A(g=>x(s),["enter"]),onBlur:g=>x(s)},{appendInner:c(()=>e[5]||(e[5]=[r("span",{class:"percent-symbol"},"%",-1)])),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(h(),G(H,{key:1},[r("span",null,k(Math.round(s.real_rate*100))+"%",1),i(N,{preset:"plain",icon:"edit",color:"rgb(47, 148, 172)",class:"ml-2",onClick:g=>I(s)},null,8,["onClick"])],64))])]),_:1},8,["items"])]),r("div",le,[i(W,{modelValue:f.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>f.value=s),O],"page-size":u.pagesize,"visible-pages":"5",total:_.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),r("span",ne," 共 "+k(_.value)+" 条记录 ",1)])]),_:1})}}},_e=q(oe,[["__scopeId","data-v-adf8b6f7"]]);export{_e as default};
//# sourceMappingURL=sub_user-R9yBovkP.js.map
