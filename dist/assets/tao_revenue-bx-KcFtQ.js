import{g as R,u as X}from"./node-2MHHTCdu.js";import{t as Z}from"./machines-le61wWj1.js";import{i as ee}from"./date-3l_ArPo2.js";import{u as ae}from"./useToast--mCIG_yF.js";import{_ as te,r,U as F,B as oe,g as le,w as s,f as c,a as b,b as k,h as n,u as se,i as h,t as w,c as P,F as M}from"./index-Tvk3_75w.js";import"./request-IlkRK3HL.js";const ne={class:"mb-4"},re={class:"filters-row"},ce={class:"table-responsive"},ie=["title"],ue=["title"],de={class:"flex justify-end mt-4"},pe={class:"ml-4 self-center text-gray-600"},me={__name:"tao_revenue",setup(_e){const{init:C}=ae(),u=r(),m=r(),z=r(""),O=r([]),_=r(O[0]),U=a=>a.map(e=>({value:e,text:e})),v=async()=>{try{const a=await Z(),e={value:"",text:"所有"};O.value=[e,...U(a||[])]}catch(a){console.error("接口调用失败:",a)}},S=(a,e)=>{if(!a)return"";if(a.length<=e)return a;const l="...";if(e<=l.length)return l.slice(0,e);const p=e-l.length,i=Math.floor(p/2),x=p-i;return a.slice(0,i)+l+a.slice(-x)},V=r(1),f=r(0),D=r([]),T=r(!1),d=F({page:1,pagesize:15,date:new Date().toISOString().split("T")[0],currency:""}),N=a=>{if(!a)return"";const e=new Date(a),l=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${l}-${p}-${i}`},g=async()=>{var a;T.value=!0;try{const e={page:d.page,pagesize:d.pagesize,currency:"tao",group:(a=_.value)==null?void 0:a.value,hotkey:m.value};u.value&&(e.date=N(u.value));const l=await R(e);l!=null&&l.pool_profits?(D.value=l.pool_profits,f.value=l.total):(D.value=[],f.value=0)}catch(e){console.error("获取数据失败:",e),C({message:e.message||"获取数据失败",color:"danger"}),D.value=[],f.value=0}finally{T.value=!1}};oe([u,z,_,m],()=>{d.page=1,V.value=1,g(),v()});const B=[{key:"id",label:"ID",width:"100px"},{key:"record_date",label:"记录日期",width:"160px"},{key:"group",label:"分组",width:"160px"},{key:"profit",label:"收益"},{key:"hotkey",label:"Hotkey",width:"240px"},{key:"coldkey",label:"Coldkey",width:"240px"},{key:"subnet",label:"子网"},{key:"need_allocate",label:"是否需要分配"},{key:"actions",label:"操作"}],y=r(!1),o=F({id:null,real_power:"",real_reward:"",need_allocate:""}),I=[{value:"1",text:"是"},{value:"0",text:"否"}],$=a=>a===1||a==="1"?"是":"否",W=a=>{o.id=a.rowData.id,o.real_power=a.rowData.real_power,o.real_reward=a.rowData.real_reward,o.need_allocate=a.rowData.need_allocate===1?"是":"否",y.value=!0},E=async()=>{var a;try{const e=await X(o.id,{real_power:Number(o.real_power),real_reward:Number(o.real_reward),need_allocate:Number((a=o.need_allocate)==null?void 0:a.value)});C({message:e,color:"success"}),await g(),await v(),y.value=!1}catch(e){console.error("修改失败:",e),C({message:e.message||"修改失败",color:"danger"})}},H=()=>{y.value=!1,j()},j=()=>{o.id=null,o.real_power="",o.real_reward="",o.need_allocate=""},q=a=>{d.page=Math.ceil(a/d.pagesize),V.value=a,g(),v()},A=()=>{u.value=null,_.value="",z.value="",m.value="",g(),v()};return g(),v(),(a,e)=>{const l=c("va-input"),p=c("va-date-input"),i=c("va-select"),x=c("va-button"),G=c("va-button-group"),Y=c("VaDataTable"),J=c("VaForm"),K=c("VaModal"),L=c("VaPagination"),Q=c("va-card");return b(),le(Q,{class:"machines-list"},{default:s(()=>[k("div",ne,[k("div",re,[n(l,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"搜索地址名",class:"mr-5",style:{maxWidth:"13%"}},{prepend:s(()=>e[6]||(e[6]=[])),_:1},8,["modelValue"]),n(p,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),placeholder:"选择日期",class:"mr-5",style:{maxWidth:"12%"},"allowed-days":t=>!se(ee)(t)},null,8,["modelValue","allowed-days"]),n(i,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),options:O.value,placeholder:"组名",class:"filter-item mr-6",style:{maxWidth:"12%"}},null,8,["modelValue","options"]),n(x,{onClick:A,class:"",color:"rgb(47, 148, 172)"},{default:s(()=>e[7]||(e[7]=[h(" 重置 ")])),_:1})])]),k("div",ce,[n(Y,{items:D.value,columns:B,striped:"",class:"responsive-table"},{"cell(record_date)":s(({value:t})=>[h(w(t?t.split("T")[0]:""),1)]),"cell(need_allocate)":s(({value:t})=>[h(w($(t)),1)]),"cell(hotkey)":s(({value:t})=>[t?(b(),P("a",{key:1,title:t,target:"_blank"},w(S(t,20)),9,ie)):(b(),P(M,{key:0},[h("无")],64))]),"cell(coldkey)":s(({value:t})=>[t?(b(),P("a",{key:1,title:t,target:"_blank"},w(S(t,20)),9,ue)):(b(),P(M,{key:0},[h("无")],64))]),"cell(actions)":s(({row:t})=>[n(G,null,{default:s(()=>[n(x,{icon:"edit",size:"small",color:"rgb(47, 148, 172)",onClick:ve=>W(t)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items"]),n(K,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),title:"修改记录",onCancel:H,onOk:E},{default:s(()=>[n(J,null,{default:s(()=>[n(i,{modelValue:o.need_allocate,"onUpdate:modelValue":e[3]||(e[3]=t=>o.need_allocate=t),label:"是否需要分配",options:I,placeholder:"请选择",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),k("div",de,[n(L,{modelValue:V.value,"onUpdate:modelValue":[e[5]||(e[5]=t=>V.value=t),q],"page-size":d.pagesize,"visible-pages":"5",total:f.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),k("span",pe," 共 "+w(f.value)+" 条记录 ",1)])]),_:1})}}},we=te(me,[["__scopeId","data-v-ffba6ad3"]]);export{we as default};
//# sourceMappingURL=tao_revenue-bx-KcFtQ.js.map
