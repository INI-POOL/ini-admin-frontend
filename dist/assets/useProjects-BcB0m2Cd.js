import{d as x,f as A,a as O,g as $,H as P,r as m,B as T,e as S,u as w}from"./index-D7A_F0Qb.js";const Z=e=>e,ee=x({__name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(e){const t=s=>{const r=["primary","#FFD43A","#ADFF00","#262824","danger"],o=s.charCodeAt(0)%r.length;return r[o]},a=s=>s?s.startsWith("http")||s.startsWith("blob:"):!1,n=s=>{try{const[r,o]=s.split(" ");return`${r[0]}${o[0]}`}catch{return s[0]}};return(s,r)=>{const o=A("VaAvatar");return O(),$(o,{size:e.size,src:a(e.user.avatar)?e.user.avatar:"","fallback-text":n(e.user.fullname),color:t(e.user.fullname)},null,8,["size","src","fallback-text","color"])}}}),v=void 0,g={allUsers:()=>`${v}/users`,user:e=>`${v}/users/${e}`,users:({page:e,pageSize:t})=>`${v}/users/?page=${e}&pageSize=${t}`,allProjects:()=>`${v}/projects`,project:e=>`${v}/projects/${e}`,projects:({page:e,pageSize:t})=>`${v}/projects/?page=${e}&pageSize=${t}`,avatars:()=>`${v}/avatars`},D=async e=>{const t=await fetch(g.allProjects()).then(a=>a.json());return{data:t,pagination:{page:e.page,perPage:e.perPage,total:t.length}}},C=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(g.allProjects(),{method:"POST",body:JSON.stringify(e),headers:t}).then(a=>a.json())},I=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(g.project(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(a=>a.json())},R=async e=>fetch(g.project(e.id),{method:"DELETE"}),b=P("projects",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:a}=await D({...e.sorting,...e.pagination});this.items=t,this.pagination=a},async add(e){const[t]=await C(e);this.items.push(t)},async update(e){const[t]=await I(e),a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1,t)},async remove(e){if(await R(e)){const a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1)}}}}),c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function k(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}let j;const F=new Uint8Array(16);function B(){if(!j){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");j=crypto.getRandomValues.bind(crypto)}return j(F)}const E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),U={randomUUID:E};function L(e,t,a){if(U.randomUUID&&!t&&!e)return U.randomUUID();e=e||{};const n=e.random||(e.rng||B)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,k(n)}const V=async e=>{const{isActive:t,search:a}=e;let n=await fetch(g.allUsers()).then(o=>o.json());n=n.filter(o=>o.active===t),a&&(n=n.filter(o=>o.fullname.toLowerCase().includes(a.toLowerCase())));const{page:s=1,perPage:r=10}=e||{};return{data:n,pagination:{page:s,perPage:r,total:n.length}}},z=async e=>{const t=new Headers;t.append("Content-Type","application/json");const a=await fetch(g.allUsers(),{method:"POST",body:JSON.stringify(e),headers:t}).then(n=>n.json());if(!a.error)return a;throw new Error(a.error)},H=async e=>{const t=new Headers;t.append("Content-Type","application/json");const a=await fetch(g.user(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(n=>n.json());if(!a.error)return a;throw new Error(a.error)},N=async e=>fetch(g.user(e.id),{method:"DELETE"}),_=async e=>fetch(g.avatars(),{method:"POST",body:e,redirect:"follow"}).then(t=>t.json()),J=P("users",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:a}=await V({...e.filters,...e.sorting,...e.pagination});this.items=t,this.pagination=a},async add(e){const[t]=await z(e);return this.items.unshift(t),t},async update(e){const[t]=await H(e),a=this.items.findIndex(({id:n})=>n===e.id);return this.items.splice(a,1,t),t},async remove(e){if(await N(e)){const a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1)}},async uploadAvatar(e){return _(e)}}}),W=()=>m({page:1,perPage:10,total:0}),q=()=>m({sortBy:"fullname",sortingOrder:null}),G=()=>m({isActive:!0,search:""}),K=e=>{const t=m(!1),a=m(),n=J(),{filters:s=G(),sorting:r=q(),pagination:o=W()}={},d=async()=>{t.value=!0;try{await n.getAll({filters:w(s),sorting:w(r),pagination:w(o)}),o.value=n.pagination}finally{t.value=!1}};T(s,()=>{o.value.page=1,d()},{deep:!0}),d();const p=S(()=>{const l=(u,f)=>f==="projects"?u.projects.map(y=>y).join(", "):u[f],i=n.items.slice((o.value.page-1)*o.value.perPage,o.value.page*o.value.perPage);return r.value.sortBy&&r.value.sortingOrder&&i.sort((u,f)=>{const y=l(u,r.value.sortBy),h=l(f,r.value.sortBy);return y>h?r.value.sortingOrder==="asc"?1:-1:y<h?r.value.sortingOrder==="asc"?-1:1:0}),i});return{error:a,isLoading:t,filters:s,sorting:r,pagination:o,users:p,fetch:d,async add(l){t.value=!0;try{return await n.add(l)}catch(i){a.value=i}finally{t.value=!1}},async update(l){t.value=!0;try{return await n.update(l)}catch(i){a.value=i}finally{t.value=!1}},async remove(l){t.value=!0;try{return await n.remove(l)}catch(i){a.value=i}finally{t.value=!1}},async uploadAvatar(l){const i=new FormData;return i.append("avatar",l),i.append("id",L()),n.uploadAvatar(i)}}};function M(){const{users:e}=K(),t=s=>e.value.find(({id:r})=>s===r),a=s=>{const r=["primary","#FFD43A","#ADFF00","#262824","danger"],o=s.charCodeAt(0)%r.length;return r[o]};return{users:e,getUserById:t,getTeamOptions:s=>s.reduce((r,o)=>{const d=t(o);return d&&r.push({label:d.fullname,src:d.avatar,fallbackText:d.fullname[0],color:a(d.fullname)}),r},[])}}const Q=()=>m({page:1,perPage:10,total:0}),X=()=>m({sortBy:"created_at",sortingOrder:"desc"}),te=e=>{const t=m(!1),a=b(),{getUserById:n}=M(),{sorting:s=X(),pagination:r=Q()}=e??{},o=async()=>{t.value=!0,await a.getAll({sorting:w(s),pagination:w(r)}),r.value=a.pagination,t.value=!1},d=S(()=>{const p=a.items.slice((r.value.page-1)*r.value.perPage,r.value.page*r.value.perPage),l=(i,u)=>{var f;return u==="project_owner"?(f=n(i.project_owner))==null?void 0:f.fullname:u==="team"?i.team.map(y=>{var h;return((h=n(y))==null?void 0:h.fullname)||""}).join(", "):u==="created_at"?new Date(i[u]):i[u]};return s.value.sortBy&&s.value.sortingOrder&&p.sort((i,u)=>(i=l(i,s.value.sortBy),u=l(u,s.value.sortBy),i<u?s.value.sortingOrder==="asc"?-1:1:i>u?s.value.sortingOrder==="asc"?1:-1:0)),p});return o(),{isLoading:t,projects:d,fetch:o,async add(p){t.value=!0,await a.add(p),await o(),t.value=!1},async update(p){t.value=!0,await a.update(p),await o(),t.value=!1},async remove(p){t.value=!0,await a.remove(p),await o(),t.value=!1},pagination:r,sorting:s}};export{ee as _,M as a,K as b,J as c,Z as d,te as u};
//# sourceMappingURL=useProjects-BcB0m2Cd.js.map
