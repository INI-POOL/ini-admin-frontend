import{u as fe}from"./useToast--mCIG_yF.js";import{p as H,g as ye}from"./request-IlkRK3HL.js";import{f as J}from"./date-3l_ArPo2.js";import{a as be}from"./user-l4GABV1l.js";import{_ as Ve,U as E,r as p,o as ke,c as D,b as t,t as o,h as n,w as l,I as K,f as d,a as c,i as u,u as x,g as f,k as w}from"./index-Tvk3_75w.js";function xe(b){return H("/api/v1/back_stage/withdraw/list",b)}function we(b){return H("/api/v1/back_stage/withdraw/audit",b)}function Ce(b){return H("/api/v1/back_stage/withdraw/pass",b)}function De(){return ye("/api/v1/back_stage/hot_address/balance")}function z(b){let i=b.toString();return i.includes(".")&&(i=i.replace(/\.?0+$/,"")),i}const ze={class:"withdraw-list"},Ue={class:"mb-4"},Te={class:"text-2xl font-bold"},Ae=["onClick"],Be={class:"action-buttons",style:{"text-align":"center"}},$e={class:"flex justify-end mt-4"},Se={class:"ml-4 self-center text-gray-600"},Ie={key:0,class:"text-center p-4"},Pe={key:1},We={class:"grid grid-cols-2 gap-4"},he={key:2,class:"text-danger p-4"},Ne={class:"space-y-4"},Me={class:"mb-4"},Le={key:0,class:"mb-4"},Fe={class:"space-y-4"},je={class:"mb-4"},Ee={key:0,class:"mb-4"},He={class:"transfer-header",style:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column",gap:"0.62rem","padding-top":"1rem"}},Oe={class:"status"},Re={class:"time"},qe={class:"transfer-info"},Ze={class:"info-row"},Ge={class:"value-box"},Je={class:"value"},Ke={class:"info-row"},Qe={class:"value-box"},Xe={class:"value"},Ye={class:"info-row"},et={class:"value-box"},tt={class:"info-row"},at={class:"value-box"},st={class:"transaction-id"},lt={class:"value-box"},ot={class:"value"},nt=["href"],rt={__name:"WithdrawList",setup(b){const{init:i}=fe(),Q=[{key:"id",label:"订单号"},{key:"uid",label:"用户编号"},{key:"mobile",label:"手机号"},{key:"amount",label:"提现金额"},{key:"gas_fee",label:"gas费"},{key:"currency",label:"币种"},{key:"status",label:"提现状态"},{key:"audit_status",label:"审核状态",sortable:!0},{key:"created_time",label:"申请时间",sortable:!0},{key:"action",label:"操作"}],C=E({page:1,pagesize:10}),O=p([]),A=p(0),W=p(1),h=p(!1),B=async()=>{h.value=!0;try{const a=await xe(C);a&&typeof a.Total=="number"?(O.value=a.Withdraws||[],A.value=parseInt(a.Total)):(console.error("API返回数据格式错误:",a),i({message:"数据格式错误",color:"danger"}))}catch(a){console.error("获取数据失败:",a),i({message:"获取数据失败",color:"danger"})}finally{h.value=!1}},U=async a=>{if(navigator.clipboard)navigator.clipboard.writeText(a).then(()=>{i({message:"复制成功",color:"success"})}).catch(e=>{i({message:"复制成功",color:"success"})});else{const e=document.createElement("textarea");e.value=a,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),i({message:"复制成功",color:"success"})}},X=a=>{C.page=Math.ceil(a/C.pagesize),W.value=a,B()},R=(a,e)=>{const v={0:"处理中",1:"成功",2:"失败",3:"确认中",4:"提现异常"};return console.log(a,e),a==2&&e>15?"Aleo网络异常":v[a]||"未知状态"},Y=a=>{const e={0:"warning",1:"success",2:"info",3:"danger"};let v=e[a]||"primary";return console.log(e[a]),v},ee=a=>({0:"待审核",1:"已通过",2:"未通过"})[a]||"未知状态",te=a=>({0:"warning",1:"success",2:"danger"})[a]||"primary",$=p(!1),S=p(!1),m=p(null),V=E({audit_status:1}),I=E({}),N=p(!1),M=p(!1),y=p(null),ae=a=>{a&&(m.value=a.rowData,V.audit_status=1,$.value=!0)},se=a=>{a&&(m.value=a.rowData,S.value=!0)},le=async a=>{N.value=!0,M.value=!0;let e={page:1,pagesize:10,uid:a.uid,currency:a.currency};try{const v=await be(e);console.log("response is",v),y.value=v==null?void 0:v[0]}catch(v){console.error("获取用户详情失败:",v),y.value=null}finally{M.value=!1}},oe=async()=>{if(!m.value)return;let a=K();if(!V.google_code){i({message:"谷歌认证码不能为空",color:"danger"});return}try{let e=await we({id:m.value.id,audit_status:V.audit_status,google_code:V.google_code,user_name:a});console.log("data is",e),e==0?i({message:"审核失败, 余额不足",color:"warning"}):(i({message:"审核成功",color:"success"}),$.value=!1,B())}catch(e){i({message:e,color:"danger"})}},ne=async()=>{if(!m.value)return;let a=K();if(!I.google_code){i({message:"谷歌认证码不能为空",color:"danger"});return}try{let e=await Ce({id:m.value.id,google_code:I.google_code,user_name:a});i({message:"转账已通过",color:"success"}),S.value=!1,B()}catch(e){i({message:e,color:"danger"})}},L=p(!1),r=p(null),re=a=>{if(!a){console.error("行数据为空");return}r.value=a.rowData,L.value=!0},q=p(0),ue=async()=>{try{const a=await De();a?q.value=parseFloat(a):console.error("热钱包余额获取失败:",a)}catch(a){console.error("热钱包余额获取失败:",a)}};return ke(()=>{B(),ue()}),(a,e)=>{const v=d("VaBadge"),F=d("VaButton"),ie=d("VaDataTable"),de=d("VaPagination"),ce=d("VaCardContent"),me=d("VaCard"),ve=d("VaProgressCircle"),k=d("va-text"),pe=d("va-card-content"),_e=d("va-card"),P=d("VaModal"),ge=d("VaRadio"),Z=d("VaInput"),T=d("VaAvatar"),G=d("VaDivider"),j=d("VaIcon");return c(),D("div",ze,[t("div",Ue,[t("h1",Te,"提现管理  (热钱包余额："+o(q.value||0)+")",1)]),n(me,null,{default:l(()=>[n(ce,null,{default:l(()=>[n(ie,{items:O.value,loading:h.value,columns:Q,"items-per-page":C.pagesize,"current-page":C.page,"total-items":A.value,selectable:!1,"show-select":!1,hoverable:"",class:"responsive-table"},{"cell(amount)":l(({value:s})=>[u(o(x(z)(s)),1)]),"cell(gas_fee)":l(({value:s})=>[u(o(x(z)(s)),1)]),"cell(uid)":l(({row:s})=>[t("span",{class:"text-primary cursor-pointer hover:underline",onClick:_=>le(s.rowData)},o(s.rowData.uid),9,Ae)]),"cell(status)":l(({row:s})=>[n(v,{color:Y(s.rowData.status)},{default:l(()=>[u(o(R(s.rowData.status,s.rowData.id)),1)]),_:2},1032,["color"])]),"cell(audit_status)":l(({value:s})=>[n(v,{color:te(s)},{default:l(()=>[u(o(ee(s)),1)]),_:2},1032,["color"])]),"cell(created_time)":l(({value:s})=>[u(o(x(J)(s)),1)]),"cell(action)":l(({row:s})=>[t("div",Be,[s?(c(),f(F,{key:0,size:"small",preset:"primary",onClick:_=>re(s)},{default:l(()=>e[13]||(e[13]=[u(" 查看 ")])),_:2},1032,["onClick"])):w("",!0),s&&Number(s.rowData.audit_status)===0&&s.rowData.currency==="aleo"?(c(),f(F,{key:1,size:"small",preset:"primary",onClick:_=>ae(s)},{default:l(()=>e[14]||(e[14]=[u(" 审核 ")])),_:2},1032,["onClick"])):w("",!0),s&&Number(s.rowData.audit_status)===0&&s.rowData.currency!="aleo"?(c(),f(F,{key:2,size:"small",preset:"primary",onClick:_=>se(s)},{default:l(()=>e[15]||(e[15]=[u(" 通过 ")])),_:2},1032,["onClick"])):w("",!0)])]),_:1},8,["items","loading","items-per-page","current-page","total-items"]),t("div",$e,[n(de,{modelValue:W.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>W.value=s),X],"page-size":C.pagesize,"visible-pages":"5",total:A.value,"buttons-preset":"secondary","boundary-numbers":""},null,8,["modelValue","page-size","total"]),t("span",Se," 共 "+o(A.value)+" 条记录 ",1)])]),_:1})]),_:1}),n(P,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=s=>N.value=s),title:"用户详情",size:"medium","hide-default-actions":""},{default:l(()=>[M.value?(c(),D("div",Ie,[n(ve,{indeterminate:""})])):y.value?(c(),D("div",Pe,[n(_e,{class:"mb-1"},{default:l(()=>[n(pe,null,{default:l(()=>[t("div",We,[t("div",null,[n(k,{class:"font-bold"},{default:l(()=>e[16]||(e[16]=[u("总收益：")])),_:1}),n(k,null,{default:l(()=>[u(o((y.value.balance_amount||0)+(y.value.total_withdraw_pending||0)+(y.value.total_withdraw_completed||0)),1)]),_:1}),e[20]||(e[20]=t("br",null,null,-1)),e[21]||(e[21]=t("br",null,null,-1)),n(k,{class:"font-bold"},{default:l(()=>e[17]||(e[17]=[u("可用余额：")])),_:1}),n(k,null,{default:l(()=>[u(o(y.value.balance_amount||0),1)]),_:1}),e[22]||(e[22]=t("br",null,null,-1)),e[23]||(e[23]=t("br",null,null,-1)),n(k,{class:"font-bold"},{default:l(()=>e[18]||(e[18]=[u("冻结 (提现中)：")])),_:1}),n(k,null,{default:l(()=>[u(o(y.value.total_withdraw_pending||0),1)]),_:1}),e[24]||(e[24]=t("br",null,null,-1)),e[25]||(e[25]=t("br",null,null,-1)),n(k,{class:"font-bold"},{default:l(()=>e[19]||(e[19]=[u("已提现 (含手续费)：")])),_:1}),n(k,null,{default:l(()=>[u(o(y.value.total_withdraw_completed||0),1)]),_:1})])])]),_:1})]),_:1})])):(c(),D("div",he," 数据加载失败，请重试。 "))]),_:1},8,["modelValue"]),n(P,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=s=>$.value=s),title:"提现审核","ok-text":"确认","cancel-text":"取消",size:"small",class:"audit-modal",onOk:oe},{default:l(()=>{var s,_;return[t("div",Ne,[t("div",null,[t("div",Me," 当前提现金额："+o(x(z)((s=m.value)==null?void 0:s.amount)||0)+" "+o(((_=m.value)==null?void 0:_.currency)||""),1),m.value.from_addr?(c(),D("div",Le," 打款地址："+o(m.value.from_addr),1)):w("",!0),e[26]||(e[26]=t("div",{class:"mb-2"},"审核结果",-1)),n(ge,{modelValue:V.audit_status,"onUpdate:modelValue":e[2]||(e[2]=g=>V.audit_status=g),options:[{text:"同意",value:1},{text:"拒绝",value:2}],"value-by":"value"},null,8,["modelValue"]),e[27]||(e[27]=t("div",{class:"mb-2",style:{"padding-top":"0.62rem"}},"谷歌认证",-1)),n(Z,{modelValue:V.google_code,"onUpdate:modelValue":e[3]||(e[3]=g=>V.google_code=g),width:"200px",placeholder:"请输入谷歌认证码"},null,8,["modelValue"])])])]}),_:1},8,["modelValue"]),n(P,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=s=>S.value=s),title:"提现通过确认","ok-text":"确认","cancel-text":"取消",size:"small",class:"audit-modal",onOk:ne},{default:l(()=>{var s,_;return[t("div",Fe,[t("div",null,[t("div",je," 当前提现金额："+o(x(z)((s=m.value)==null?void 0:s.amount)||0)+" "+o(((_=m.value)==null?void 0:_.currency)||""),1),m.value.from_addr?(c(),D("div",Ee," 打款地址："+o(m.value.from_addr),1)):w("",!0),e[28]||(e[28]=t("div",{class:"mb-2"},"⚠️注意: 执行此操作前, 请确认链上是否已到账.",-1)),e[29]||(e[29]=t("div",{class:"mb-2",style:{"padding-top":"0.62rem"}},"谷歌认证",-1)),n(Z,{modelValue:I.google_code,"onUpdate:modelValue":e[5]||(e[5]=g=>I.google_code=g),width:"200px",placeholder:"请输入谷歌认证码"},null,8,["modelValue"])])])]}),_:1},8,["modelValue"]),n(P,{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=s=>L.value=s),title:"转账详情",size:"medium",class:"mr-6 my-1","close-button":""},{content:l(()=>{var s,_;return[t("div",He,[r.value.status===0?(c(),f(T,{key:0,color:"info"},{default:l(()=>e[30]||(e[30]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," more_horiz ",-1)])),_:1})):r.value.status===1?(c(),f(T,{key:1,color:"success"},{default:l(()=>e[31]||(e[31]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," check ",-1)])),_:1})):r.value.status===2?(c(),f(T,{key:2,color:"danger"},{default:l(()=>e[32]||(e[32]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," close ",-1)])),_:1})):r.value.status===3?(c(),f(T,{key:3,color:"warning"},{default:l(()=>e[33]||(e[33]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," directory_sync ",-1)])),_:1})):r.value.status===4?(c(),f(T,{key:4,color:"danger"},{default:l(()=>e[34]||(e[34]=[t("span",{class:"material-symbols-outlined",style:{"font-size":"40px"}}," check ",-1)])),_:1})):w("",!0),t("div",Oe,o(R(r.value.status,r.value.id)),1),t("div",Re,o(x(J)(r.value.created_time)),1)]),n(G),t("div",qe,[t("div",Ze,[e[35]||(e[35]=t("span",{class:"label"},"数额：",-1)),t("div",Ge,[t("span",Je,o(x(z)((s=r.value)==null?void 0:s.amount)||0)+" "+o(r.value.currency),1)])]),t("div",Ke,[e[36]||(e[36]=t("span",{class:"label"},"提款手续费：",-1)),t("div",Qe,[t("span",Xe,o(x(z)((_=r.value)==null?void 0:_.gas_fee)||0)+" "+o(r.value.currency),1)])]),t("div",Ye,[e[38]||(e[38]=t("span",{class:"label"},"收款地址：",-1)),t("div",et,[t("span",{class:"value",onClick:e[7]||(e[7]=g=>U(r.value.to_addr))},o(r.value.to_addr),1),n(j,{class:"material-icons",onClick:e[8]||(e[8]=g=>U(r.value.to_addr))},{default:l(()=>e[37]||(e[37]=[u(" content_copy ")])),_:1})])]),t("div",tt,[e[40]||(e[40]=t("span",{class:"label"},"付款地址：",-1)),t("div",at,[t("span",{class:"value",onClick:e[9]||(e[9]=g=>U(r.value.from_addr))},o(r.value.from_addr),1),r.value.from_addr?(c(),f(j,{key:0,class:"material-icons",onClick:e[10]||(e[10]=g=>U(r.value.from_addr))},{default:l(()=>e[39]||(e[39]=[u(" content_copy ")])),_:1})):w("",!0)])])]),n(G),t("div",st,[e[42]||(e[42]=t("span",{class:"label"},"交易号：",-1)),t("div",lt,[t("span",ot,[t("a",{href:`https://mainnet.aleo123.io/transactionDetail/${r.value.tx_id}`,target:"_blank"},o(r.value.tx_id),9,nt)]),r.value.tx_id?(c(),f(j,{key:0,class:"material-icons",onClick:e[11]||(e[11]=g=>U(r.value.tx_id))},{default:l(()=>e[41]||(e[41]=[u(" content_copy ")])),_:1})):w("",!0)])])]}),_:1},8,["modelValue"])])}}},vt=Ve(rt,[["__scopeId","data-v-1d95e8d1"]]);export{vt as default};
//# sourceMappingURL=WithdrawList-CEwUOcPP.js.map
